# 1ã€ğŸš€ å¼€å‘è¾…åŠ©


# 2ã€ğŸ¾ Git & VCS

## è§£å†³ `fatal: æ— æ³•è®¿é—® 'https://github.com/gukt/rainbow.git/'ï¼šLibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to github.com:443` çš„é—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

æŸ¥çœ‹æ˜¯å¦è®¾ç½®äº†å…¨å±€ä»£ç†ï¼š

```bash
$ git config --global http.proxy
```

å¦‚æœæ²¡çœ‹åˆ°è¾“å‡ºï¼Œè¯´æ˜æ²¡æœ‰è®¾ç½®ã€‚è¿è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œè®¾ç½®ï¼š

```bash
git config --global http.proxy 127.0.0.1:1087
```

æ³¨æ„ï¼šä»¥ä¸Š `127.0.0.1:1087` å°±æ˜¯æˆ‘ä»¬çš„ä»£ç†åœ°å€ï¼Œè¿™æ˜¯é€‰æ‹©çš„æ˜¯ HTTP ä»£ç†ã€‚

å†æ¬¡è¿è¡Œ `git config --global http.proxy` å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°åœ°å€å°±è¯´æ˜æˆåŠŸäº†ã€‚

```bash
$ git config --global http.proxy
127.0.0.1:1087
```

ç°åœ¨ç›´æ¥åœ¨å‘½ä»¤è¡Œçª—å£æ‰§è¡Œ `git push` å°±å¯ä»¥çœ‹åˆ°ä¸€åˆ‡æ­£å¸¸äº†ã€‚

å¦‚æœéœ€è¦ç§»é™¤ä»£ç†ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š

```bash
$ git config --global --unset http.proxy
```


## å¦‚ä½•å’Œè¿œç¨‹ä»“åº“å»ºç«‹å…³è”

å¦‚æœé¡¹ç›®å·²å­˜åœ¨äºè¿œç¨‹ä»“åº“ä½†æ²¡æœ‰æœ¬åœ°ä»“åº“ï¼Œéœ€è¦å…‹éš†åˆ°æœ¬åœ°ï¼š

```bash
git clone <http://git.laogu.io:10001/root/url-rescuer.git>
cd hello
touch README.md
git add README.md
git commit -m "add README"
git push -u origin master
```

**å¦‚æœé¡¹ç›®å·²å­˜åœ¨äºæœ¬åœ°ä¸”è¿˜æ²¡æœ‰å’Œä»»ä½•ä»“åº“å…³è”**ï¼Œåˆ™æŒ‰å¦‚ä¸‹æ­¥éª¤å°†æœ¬åœ°é¡¹ç›®pushåˆ°è¿œç¨‹ä»“åº“ï¼š

```bash
#è¿›å…¥å·²å­˜åœ¨çš„é‚£ä¸ªç›®å½•
cd path_to_repo
#Initialize an empty Git repository
git init
#æ·»åŠ ä¸€ä¸ªremoteåç§°ï¼ˆorigin)å’Œè¿œç¨‹ä»“åº“å…³è”
git remote add origin <http://git.laogu.io:10001/root/url-rescuer.git>
git add .
git commit -m "Initial commit"
#å°†å˜åŒ–æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸­çš„masteråˆ†æ”¯
git push -u origin main
#æ­¤æ—¶ä¼šæç¤ºç”¨æˆ·åå’Œå¯†ç ï¼Œè¾“å…¥åå›è½¦ã€‚
```

å¦‚æœæœ¬åœ°å·²ç»æ˜¯ä¸€ä¸ª git ä»“åº“ï¼Œéœ€è¦å’Œè¿œç¨‹ä»“åº“å…³è”ï¼š

```bash
cd existing_repo
git remote rename origin old-origin
git remote add origin <http://git.laogu.io:10001/root/nn-stats.git>
git push -u origin --all
git push -u origin --tags
```

 

## å¦‚ä½•åˆ é™¤å·²ç»æ·»åŠ åˆ°è¿œç¨‹ä»“åº“ä¸­çš„éœ€è¦å¿½ç•¥çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹

```bash
#è¦åˆ é™¤çš„æ˜¯è¿œç¨‹ä»“åº“ä¸­å·²ç»æäº¤è¿‡çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä½†æ˜¯working treeä¸­çš„æ–‡ä»¶éœ€è¦ä¿ç•™çš„
#å› æ­¤æˆ‘ä»¬åªéœ€è¦å°†indexåŒºåŸŸä¸­çš„æ–‡ä»¶åˆ æ‰åæäº¤ï¼Œç„¶åå°†ä¿®æ”¹pushåˆ°è¿œç¨‹ä»“åº“å³å¯
#-rè¡¨ç¤ºé€’å½’åˆ é™¤ï¼Œ--cachedè¡¨ç¤ºä»…åˆ é™¤indexåŒºçš„æ–‡ä»¶
git rm -r --cached .idea build
#æäº¤æ›´æ”¹
git commit -m "Remove .idea and build folder"
#å°†æ›´æ”¹pushåˆ°è¿œç¨‹ä»“åº“
git push -u origin master
#è‡³æ­¤ï¼Œåˆ·æ–°è¿œç¨‹ä»“åº“çœ‹çœ‹ç›¸å…³æ–‡ä»¶æ˜¯å¦å·²ç»è¢«åˆ é™¤
```

 



# 3ã€ğŸ’¿ MySQL / JPA / ORM

## è§£å†³ glibc ç‰ˆæœ¬è¿‡ä½å¯¼è‡´å®‰è£… mysql 5.7 å¤±è´¥çš„é—®é¢˜

### é—®é¢˜æè¿°

```sh
é”™è¯¯ï¼šPackage: mysql-community-client-5.7.23-1.el7.x86_64 (mysql57-community)
          Requires: libc.so.6(GLIBC_2.14)(64bit)
```

### è§£å†³æ–¹æ¡ˆ

è¿™æ˜¯å› ä¸ºåŸç³»ç»Ÿä¸­çš„glibcç‰ˆæœ¬æ˜¯2.12ï¼Œéœ€è¦å‡çº§åˆ° 2.17ã€‚

```sh
ldd --version
ldd (GNU libc) 2.12
```

å‡çº§ glibcï¼š

```sh
#é¦–å…ˆå…ˆè¦å®‰è£…gcc
yum install -y gcc

#ä¸‹è½½glibc2.17æºæ–‡ä»¶å¹¶è§£å‹åˆ°æŒ‡å®šçš„ç›®å½•
xz -d glibc-2.17.tar.xz 
tar -xvf glibc-2.17.tar 
cd glibc-2.17 
mkdir build 
cd build 

#ç¼–è¯‘
../configure --prefix=/usr --disable-profile --enable-add-ons --with-headers=/usr/include --with-binutils=/usr/bin

#å®‰è£…
make && make install
...
Your new glibc installation seems to be ok.
make[1]: Leaving directory `/root/glibc-2.17'

#æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ
ldd --version
ldd (GNU libc) 2.17
Copyright (C) 2012 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
ç”± Roland McGrath å’Œ Ulrich Drepper ç¼–å†™ã€‚

Cheers!!!
```



## è§£å†³ WARN: Establishing SSL connection without server's identity verification is not recommended... çš„é—®é¢˜

åœ¨è¿æ¥å­—ç¬¦ä¸²ä¸­æ·»åŠ  `useSSL=false` å±æ€§ï¼š

```
jdbcUrl=jdbc:mysql://db.domain.com:3306/test?useSSL=false&useUnicode=true&zeroDateTimeBehavior=convertToNull&characterEncoding=utf-8
```



## MySQL ä¸­çš„æ•´å½¢ï¼ˆIntegerï¼‰å’Œå°æ•°ï¼Ÿ

MySQL ä¸­æœ‰ä»¥ä¸‹å‡ ç§æ•´å½¢ï¼Œè¡¨ç¤ºçš„èŒƒå›´ä¸ä¸€æ ·ï¼š

* TINYINTï¼š1 ä¸ªå­—èŠ‚ã€‚(-128ï¼Œ127)ï¼Œæ— ç¬¦å·ï¼š(0ï¼Œ255)
* SMALLINTï¼š2 ä¸ªå­—èŠ‚ï¼ˆ(-32 768ï¼Œ32 767)ï¼‰ï¼Œæ— ç¬¦å·ï¼š(0ï¼Œ65 535)
* MEDIUMINTï¼š3 ä¸ªå­—èŠ‚ï¼š(-8 388 608ï¼Œ8 388 607)ï¼Œæ— ç¬¦å·ï¼š(0ï¼Œ16 777 215)
* INT æˆ– INTEGERï¼š4 ä¸ªå­—èŠ‚ï¼š(-2 147 483 648ï¼Œ2 147 483 647)ï¼Œæ— ç¬¦å·ï¼š(0ï¼Œ4 294 967 295)
* BIGINTï¼š8 ä¸ªå­—èŠ‚ï¼š(-9,223,372,036,854,775,808ï¼Œ9 223 372 036 854 775 807)ï¼Œæ— ç¬¦å·ï¼š(0ï¼Œ18 446 744 073 709 551 615)

å°æ•°ï¼š

* FLOATï¼š4 bytesï¼Œå•ç²¾åº¦æµ®ç‚¹å€¼ï¼š(-3.402 823 466 E+38ï¼Œ-1.175 494 351 E-38)ï¼Œ0ï¼Œ(1.175 494 351 E-38ï¼Œ3.402 823 466 351 E+38)ï¼Œæ— ç¬¦å·ï¼š0ï¼Œ(1.175 494 351 E-38ï¼Œ3.402 823 466 E+38)
* DOUBLEï¼š8 ä¸ªå­—èŠ‚ï¼šåŒç²¾åº¦æµ®ç‚¹å€¼ï¼š(-1.797 693 134 862 315 7 E+308ï¼Œ-2.225 073 858 507 201 4 E-308)ï¼Œ0ï¼Œ(2.225 073 858 507 201 4 E-308ï¼Œ1.797 693 134 862 315 7 E+308)ï¼Œæ— ç¬¦å·ï¼š0ï¼Œ(2.225 073 858 507 201 4 E-308ï¼Œ1.797 693 134 862 315 7 E+308)
* DECIMALï¼šé€šå¸¸ç”¨äºå­˜å‚¨è´§å¸è¿™ç§ä¿ç•™ç²¾åº¦çš„å°æ•°å€¼ã€‚
  * è¯­æ³•ï¼šcolumn_name ``DECIMAL``(P,D);
  * `P`æ˜¯è¡¨ç¤ºæœ‰æ•ˆæ•°å­—æ•°çš„ç²¾åº¦ã€‚ `P`èŒƒå›´ä¸º`1ã€œ65`ã€‚
  * Dæ˜¯è¡¨ç¤ºå°æ•°ç‚¹åçš„ä½æ•°ã€‚ Dçš„èŒƒå›´æ˜¯0~30ã€‚MySQLè¦æ±‚Då°äºæˆ–ç­‰äº(<=)P
  * `DECIMAL(Pï¼ŒD)`è¡¨ç¤ºåˆ—å¯ä»¥å­˜å‚¨`D`ä½å°æ•°çš„`P`ä½æ•°ã€‚åè¿›åˆ¶åˆ—çš„å®é™…èŒƒå›´å–å†³äºç²¾åº¦å’Œåˆ»åº¦ã€‚

æ·»åŠ  columnDefinition



## å­—æ®µé™å®šï¼šè®¾ç½®æœ€å¤§é•¿åº¦åŠé»˜è®¤å€¼

### è®¾å®šå­—ç¬¦ä¸²åˆ—çš„æœ€å¤§é•¿åº¦åŠé»˜è®¤å€¼

```java
@Column(nullable = false, columnDefinition = "varchar(25) default ''")
private String platform;

@Column(nullable = false, length = 100)
@JsonIgnore
private String password;
```

### è®¾å®šå„ç§ç±»å‹æ•´å½¢å­—æ®µé•¿åº¦åŠé»˜è®¤å€¼

```java
@Column(nullable = false, columnDefinition = "int(11) default 0")
private Long fromId = 0L;
```

**æ³¨æ„ï¼šint(11) è¡¨ç¤ºå­—ç¬¦çš„æ˜¾ç¤ºå®½åº¦ï¼Œä¸æ˜¯æœ€å¤§é•¿åº¦ä¸º 11ã€‚**

int è¡¨ç¤º 4 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ•´å½¢ï¼Œå…¶è¡¨ç¤ºèŒƒå›´å¦‚ä¸‹ï¼š

* æœ‰ç¬¦å·ï¼š(-2 147 483 648ï¼Œ2 147 483 647)
* æ— ç¬¦å·ï¼š(0ï¼Œ4 294 967 295)

#### è®¾å®š boolean ç±»å‹é»˜è®¤å€¼ï¼š

```java
@Column(nullable = false, columnDefinition = "bit default 0")
private Boolean inactive = false;

@Column(nullable = false, columnDefinition = "mediumint default 0")
private Integer sid;

@Column(nullable = false, columnDefinition = "tinyint default 0")
private Integer type;
```

MySQL æ”¯æŒçš„æ•´å½¢ç±»å‹æœ‰ï¼šTINYINTï¼ˆ1 ä¸ªå­—èŠ‚ï¼‰ï¼ŒSMALLINTï¼ˆ2 ä¸ªå­—èŠ‚ï¼‰ï¼ŒMEDIUINTï¼ˆ3 ä¸ªå­—èŠ‚ï¼‰ï¼ŒINT/INTEGERï¼ˆ4 ä¸ªå­—èŠ‚ï¼‰ï¼ŒBIGINTï¼ˆ8 ä¸ªå­—èŠ‚ï¼‰ï¼Œå¯¹äº JAVA ä¸­çš„ Long å‹ï¼ŒMYSQL ä¸­è¦ç”¨ BIGINT å­˜å‚¨ã€‚

#### è®¾ç½® JSON å­—æ®µç±»å‹åŠé»˜è®¤å€¼ï¼š

```java
@TypeDefs({
        @TypeDef(name = "json", typeClass = JsonStringType.class),
})
public class Mail {
  	...
		@Type(type = "json")
    @Column(nullable = false, columnDefinition = "json default '{}'")
    private Map<String,Object> attachment;
    ...
}
```



## ä¸èƒ½ä½¿ç”¨ `from` åšä¸º MYSQL å­—æ®µåã€‚

å¾ˆæ˜¾ç„¶äº†ï¼ŒFROM æ˜¯æœ€å¸¸ç”¨çš„å…³é”®å­—ã€‚



## æ·»åŠ å¯¹ JSR-303ï¼ˆéªŒè¯ï¼‰ çš„æ”¯æŒ

æ·»åŠ ä¾èµ–ï¼š

```groovy
implementation 'javax.validation:validation-api:2.0.1.Final'
implementation 'org.hibernate:hibernate-validator:7.0.1.Final'
```

`hibernate-validator`æ˜¯ JSR-303 API çš„ä¸€ä¸ªå®ç°ï¼Œå¦‚æœä¸æ·»åŠ ï¼Œå¯åŠ¨æ—¶ä¼šæç¤ºå¦‚ä¸‹é”™è¯¯ï¼š

```
...
Add an implementation, such as Hibernate Validator, to the classpath
```

## Yum å®‰è£… MySQL 5.6

```bash
$ yum remove mysql57-community-release.noarch
$ yum clean all
$ yum install <https://dev.mysql.com/get/mysql57-community-release-el6-11.noarch.rpm>
$ yum -y install mysql-community-server
```





# 4ã€â˜˜ï¸ Spring & SpringBoot

## IDEA æç¤ºï¼šSpring Boot Configuration Annotation Processor not configured.

è¿™æ˜¯å› ä¸ºå½“å‰é¡¹ç›®ä¸­ç¼ºå°‘ `spring-boot-configuration-processor` ä¾èµ–ï¼Œæ·»åŠ å¦‚ä¸‹è¡Œï¼š

build.gradleï¼š

```groovy
dependencies {
  	...
    annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'
}
```

æ·»åŠ åï¼Œé‡æ–° `Load gradle changes` å³å¯ã€‚



## æŒ‰ç±»å‹æ³¨å…¥æ—¶ï¼Œå‘ç°æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥æ³¨å…¥æ€ä¹ˆåŠï¼Ÿ

**é—®é¢˜æè¿°ï¼š**

```java
org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type 'io.laogu.pylon.tmp.FooService' available: expected single matching bean but found 2: fooServiceA,fooServiceB
```

è¿™æ˜¯å› ä¸ºé€šè¿‡ `@Autowired` æ³¨å…¥æ—¶ï¼Œå‘ç°äº†æŒ‡å®šçš„ç±»å‹æœ‰ä¸¤ä¸ªå®ä¾‹ï¼ŒSpring ä¸çŸ¥é“ç”¨å“ªä¸ªï¼Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆå¯ä»¥è§£å†³ï¼š

1. ä½¿ç”¨ `@Qualified("fooServiceA")` æŒ‡å®šåç§°ï¼ŒæŒ‰åç§°æ³¨å…¥ã€‚
2. åœ¨ `FooServiceA` æˆ– `FooServiceB` ä¸Šçš„æŸä¸€ä¸ªä¸Šä½¿ç”¨ `@Primary`ã€‚



## å…³äº properties å’Œ yaml æ–‡ä»¶ä¸­çš„æ•°ç»„é…ç½® 

application.properties:

```properties
my.servers[0]=dev.example.com
my.servers[1]=another.example.com
```

application.yaml:

```yaml
my:
servers:
	- dev.example.com
	- another.example.com
```

è‡ªåŠ¨ä» application.properties/yaml ä¸­è¯»å–é…ç½®åˆ°ç»“æ„åŒ–å¯¹è±¡ï¼š

```java
@ConfigurationProperties(prefix="my")
public class Config {

	private List<String> servers = new ArrayList<String>();

	public List<String> getServers() {
		return this.servers;
	}
}
```



## Spring ä¸­åˆ¤æ–­æ˜¯å¦æ˜¯èµ„æºç±»å‹

```
Class<?> clazz = getReturnValueType(value, returnType);
return clazz != InputStreamResource.class && Resource.class.isAssignableFrom(clazz);
```



## Spring data jpa æ˜ å°„ snake-case å­—æ®µå

åœ¨ä½¿ç”¨ `Spring data jpa` æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring ä¼šå°† `camel-case` å½¢å¼çš„å¯¹è±¡å±æ€§åï¼Œæ˜ å°„åˆ°æ•°æ®ä¸­çš„çš„å­—æ®µåä¸º `snake-case` å½¢å¼ã€‚

æ¯”å¦‚ï¼š`firstName` å±æ€§ä¼šè¢«æ˜ å°„æˆ `first_name` å­—æ®µã€‚

å¦‚æœæˆ‘ä»¬æœŸæœ›æ•°æ®åº“å­—æ®µåä¿æŒå’Œå±æ€§ä¸€ç›´ï¼Œåˆ™å¯ä»¥æ·»åŠ å¦‚ä¸‹è®¾ç½®ï¼š

```basic
jpa.hibernate.naming.physical-strategy = org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
```



## è§£å†³ Spring boot: could not initialize proxy - no Session çš„é—®é¢˜

### é—®é¢˜æè¿°

```properties
2018-09-08 13:58:04.533  WARN 96697 --- [nio-8082-exec-3] .m.m.a.ExceptionHandlerExceptionResolver : Resolved exception caused by Handler execution: org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: failed to lazily initialize a collection of role: com.yfs.cms.admin.domain.Post.meta, could not initialize proxy - no Session; nested exception is com.fasterxml.jackson.databind.JsonMappingException: failed to lazily initialize a collection of role: com.yfs.cms.admin.domain.Post.meta, could not initialize proxy - no Session (through reference chain: com.yfs.cms.admin.util.ApiResponse["data"]->org.springframework.data.domain.PageImpl["content"]->java.util.Collections$UnmodifiableRandomAccessList[0]->com.yfs.cms.admin.domain.Post["meta"])
```

### è§£å†³æ–¹æ¡ˆ

åœ¨ `application.properties` æ–‡ä»¶ä¸­ï¼Œæ·»åŠ è¿™ä¸€è¡Œï¼ˆ**æˆ–ä¸æ·»åŠ ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„**ï¼‰

```properties
spring.jpa.open-in-view=true
```

## å¦‚ä½•å¯ç”¨ devtools

1. æ‰“å¼€ `build.gradle` æ–‡ä»¶ï¼Œåœ¨ `dependencies` ä¸­æ·»åŠ ä¾èµ–é¡¹ï¼š`compile("org.springframework.boot:spring-boot-devtools")`

2. æ‰“å¼€ `application.properties` ï¼Œè®¾ç½®ä¸¤ä¸ªå¼€å…³

   ```java
   spring.devtools.livereload.enabled=true
   spring.devtools.restart.enabled=true
   ```

3. å¦‚æœéœ€è¦æ”¯æŒ `liverload` ï¼Œéœ€ä¸‹è½½å¹¶å®‰è£… `livereload` æ’ä»¶ï¼Œè¿™æ ·å½“appé‡å¯åï¼Œæµè§ˆå™¨é¡µé¢ä¹Ÿä¼šè‡ªåŠ¨reloadã€‚

4. æ‰“å¼€ IDEA çš„ `Preferences` -> `Build, Execution, Deployment` -> `Compiler` -> å°† `Build project automatically` å‹¾é€‰ä¸Šã€‚

5. åœ¨ IDEA ä¸­è¾“å…¥å¿«æ·é”® `shift+option+command+/` ï¼Œé€‰æ‹© `Registry...` ï¼Œå‹¾é€‰ `compiler.automake.allow.when.app.running`

## å¯åŠ¨æ—¶ï¼Œæç¤ºï¼šCannot find template location: classpath:/templates/ (please add some templates or check your Thymeleaf configuration)

è¿™æ˜¯å› ä¸ºæ£€æµ‹åˆ°æ²¡æœ‰ `templates` ç›®å½•ã€æˆ–è¯¥ç›®å½•æ²¡æœ‰ä»»ä½• `template` æ–‡ä»¶ï¼Œå¯ä»¥å¿½ç•¥ã€‚

è§£å†³æ–¹æ¡ˆï¼šåœ¨ `application.properties` ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š

```java
spring.thymeleaf.check-template=false
spring.thymeleaf.check-template-location=false
```

## å¯åŠ¨æ—¶ï¼Œæç¤ºï¼šFor Jackson Kotlin classes support please add â€œcom.fasterxml.jackson.module:jackson-module-kotlinâ€ to the classpath

è§£å†³æ–¹æ¡ˆï¼šåœ¨ `build.gradle` çš„ `dependencies` é‡Œæ·»åŠ ä¾èµ–å³å¯ï¼š

```groovy
dependencies {
    compile group: 'com.fasterxml.jackson.module', name: 'jackson-module-kotlin', version: '2.11.2'
}
```

## org.hibernate.LazyInitializationException: could not initialize proxy [com.jjx.domain.Role#1] - no Session

è§£å†³æ–¹æ¡ˆï¼šåœ¨ `application.properties` é‡Œæ·»åŠ å¦‚ä¸‹è¡Œï¼š

```java
open-in-view: true
```

è¿™æ˜¯æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œæ›´å¤šå…³äº`open-in-view` çš„ç¼ºç‚¹å’Œåæ¨¡å¼ï¼Œè¯·æ›´æ·±å…¥åœ°å­¦ä¹ ã€‚

## HikariPool-1 - idleTimeout is close to or more than maxLifetime, disabling it.

è¿™æ˜¯å› ä¸º `idleTimeout`ï¼ˆé»˜è®¤ä¸º 10 åˆ†é’Ÿï¼‰ ä¸èƒ½è®¾ç½®ä¸ºå¤§äº `maxLifetime`ï¼ˆé»˜è®¤ 30 åˆ†é’Ÿï¼‰ - 1ç§’ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¼šæ°¸è¿œä¸ç©ºé—²ã€‚

è§£å†³æ–¹æ¡ˆï¼šå¦‚æœä½ é‡æ–°è®¾ç½®äº† `maxLifeTime` ä¸”å°äºæˆ–ç­‰äº 10 åˆ†é’Ÿï¼Œåˆ™ä¹Ÿè¦ç›¸åº”çš„é‡è®¾ `idleTimeout`ã€‚

```java
datasource.hikari.max-lifetime=480000
datasource.hikari.idle-timeout=360000
```

# 5ã€ğŸ”¥ VUE

## Element ä¸­é€‰æ‹©å™¨æ¯æ¬¡é€‰æ‹©åä¸è®°å½•é€‰æ‹©é¡¹çš„æœ€ä½³å®è·µ

åœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚æ‰¹é‡æ“ä½œä¸‹æ‹‰æ¡†ï¼Œä¸ç®¡é€‰æ‹©é¡¹ç›®å‘ç”Ÿå¦‚ä½•æ”¹å˜ï¼Œå¸Œæœ›é»˜è®¤é€‰ä¸­é¡¹æ€»æ˜¯å®šä½åœ¨ï¼š`æ‰¹é‡æ“ä½œ...`

è¿™æ—¶ï¼Œä¸åº”è¯¥è®¾å®š v-model ä¸ºä¸€ä¸ªå˜é‡ï¼Œåªç”¨è®¾ç½® value = "" å³å¯ã€‚

```vue
<el-select value="" v-loading.fullscreen.lock="fullscreenLoading"
                 placeholder="æ‰¹é‡æ“ä½œ..." @change="onBatchActionChanged">
```

å¦‚æœè®¾å®šäº† `v-model` ç»™ä¸€ä¸ªå˜é‡ï¼Œæ„å‘³ç€æ¯æ¬¡å‘ç”Ÿé€‰æ‹©é¡¹ç›®å˜æ›´ï¼Œè¢«ç»‘å®šå˜é‡å°±è‡ªåŠ¨è®¾ç½®ä¸ºäº†æœ€æ–°é€‰æ‹©çš„å€¼ï¼Œé‚£ä¹ˆï¼Œæ¯æ¬¡åœ¨å‘ç”Ÿ @change äº‹ä»¶åï¼Œè¿˜éœ€è¦åœ¨ä»£ç é‡Œå°†å…¶è®¾ä¸º null ï¼Œå¤šæ¬¡ä¸€ä¸¾ã€‚

NOTEï¼š@change åªéœ€è¦æŒ‡å®šæ–¹æ³•åå°±å¯ä»¥ï¼Œé€‰ä¸­é¡¹ä¼šä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ onBatchActionChanged å¤„ç†å‡½æ•°ä¸­ã€‚

> å¯¹äºé‚£äº›é€‰æ‹©åï¼Œéœ€è¦ç­‰å¾…è¿›ä¸€æ­¥ç¡®è®¤çš„ä¸‹æ‹‰æ¡†ï¼Œéœ€è¦ä½¿ç”¨ v-model ç»‘å®šå±æ€§ã€‚



## ä¸€ä¸ªå…¸å‹çš„ radio group çš„å†™æ³•

```vue
<el-radio-group v-model="formData.kind">
  <el-radio :label="1">æ”¯æŒ</el-radio>
  <el-radio :label="2">åå¯¹</el-radio>
</el-radio-group>
```

> æ³¨æ„äº‹é¡¹
>
> 1. å†™ä»£ç æ—¶é—´é•¿äº†å¯èƒ½æœ‰æƒ¯æ€§æ€ç»´ï¼Œè§‰å¾— value åº”è¯¥æ˜¯å€¼ï¼Œlabel åº”è¯¥æ˜¯æ˜¾ç¤ºçš„åç§°ï¼Œä½†æ˜¯åœ¨ element ui ä¸­å¹¶ä¸æ˜¯è¿™æ ·ï¼Œlabel ç”¨æ¥è¡¨ç¤ºå€¼ï¼Œæ˜¾ç¤ºçš„æ–‡æœ¬å†™åœ¨æ ‡ç­¾ä¸­é—´ã€‚
> 2. å¦‚æœ label ä¹‹å‰ä¸åŠ å†’å·ï¼Œåˆ™è®¤ä¸ºå€¼æ˜¯ String ç±»å‹ï¼Œå¦‚æœæƒ³ç»‘å®š Number ç±»å‹ï¼Œåœ¨ label å‰é¢åŠ ä¸ªå†’å·å³å¯ã€‚



## ä½¿ç”¨ vue-cli æ­å»ºè„šæ‰‹æ¶

### å®‰è£… node å’Œ npm

```sh
#æ£€æŸ¥æœ‰æ²¡æœ‰å®‰è£…è¿‡nodejs
$node -v

#å®‰è£…node@mac
$ brew install nodejs

#å¦‚æœå·²ç»å®‰è£…è¿‡nodeä½†ä¸çŸ¥é“åœ¨é‚£é‡Œ
$ brew info nodejs

#æŸ¥çœ‹ç‰ˆæœ¬
$ node -v
v10.4.1

#æŸ¥çœ‹npmç‰ˆæœ¬
$ npm -v
6.2.0

#æŸ¥çœ‹å…¨å±€node_modulesæ‰€åœ¨è·¯å¾„
$ find / -name node_modules
#ä¸€èˆ¬ä¼šå®‰è£…åœ¨/usr/local/lib/node_modulesç›®å½•

#å®‰è£…æ·˜å®é•œåƒ
npm install -g cnpm --registry=https://registry.npm.taobao.org
```

### å®‰è£…webpack

```sh
npm install webpack -g
```

### å®‰è£…vue-cli

```sh
npm install vue-cli -g
```

### åˆå§‹åŒ–é¡¹ç›®è„šæ‰‹æ¶

```sh
#è¿›å…¥é¡¹ç›®æ‰€åœ¨æ ¹ç›®å½•
cd ~/github

#åˆå§‹åŒ–é¡¹ç›®è„šæ‰‹æ¶(ä¸€è·¯å›è½¦ä¸‹å»)
vue init webpack vue-demo1
```

 

## TypeError: Cannot read property 'length' of undefined

é—®é¢˜æè¿°ä¸è§£å†³æ–¹æ¡ˆï¼š

å‡ºç°è¿™ç§é—®é¢˜ï¼Œä¸€èˆ¬å»æ£€æŸ¥å“ªé‡Œçš„ for å¾ªç¯ä½¿ç”¨äº†æ•°ç»„ï¼Œä½†è¿™ä¸ªæ•°ç»„æœªå®šä¹‰ï¼›æˆ–è€…ä½ ä¸»è§‚è®¤ä¸ºå·²ç»åˆå§‹åŒ–è¿‡äº†ï¼Œä½†åœ¨ä»£ç çš„æŸä¸ªåœ°æ–¹å¯èƒ½è¯¯å°†å®ƒåˆè¦†ç›–æ‰äº†ã€‚

æ¯”å¦‚ï¼š

```vue
<el-checkbox-group v-model="formData.tags" :max="4">
   <el-checkbox v-for="item in tags" :key="item" :label="item">{{ item }}</el-checkbox>
</el-checkbox-group>

<script>
defaultFormData = {
 	k1: v1
}

data() {
  return {
    formData: {
      // ä½ è®¤ä¸ºè¿™ä¸æ˜æ˜æ˜¯å®šä¹‰è¿‡äº†å—ï¼Ÿ
      tags: []
    }
  }
},
created() {
  // ä½†æ˜¯è¿™é‡Œç”±äºç–å¿½ï¼Œå°† formData ç”¨ defaultFormData ä¸­çš„æ•°æ®ç»™è¦†ç›–äº†ã€‚
  // è¿™æ®µä»£ç çš„æœ¬æ„æ˜¯è¦åˆå¹¶ä¸¤ä¸ªå¯¹è±¡å±æ€§
  this.formData = Object.assign({}, defaultFormData)
}
</script>
```



# 6ã€â™¨ï¸ JAVA

## è§£å†³ VisualVM æ’ä»¶ä¸­å¿ƒè¿æ¥ä¸ä¸Šçš„é—®é¢˜

å› ä¸º Java VisualVM é»˜è®¤çš„æ’ä»¶ä¸­å¿ƒå·²å…³é—­æœåŠ¡ã€‚æ–°çš„åœ°å€æ˜¯ï¼šhttps://visualvm.github.io/pluginscenters.htmlã€‚

æ‰“å¼€è¿æ¥ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åœ°å€ã€‚æ¯”å¦‚ä»¥ä¸‹è¿™ä¸ªåœ°å€ï¼š

```
JDK 8 Update 40 - 121
JDK 7 Update 79 - 80
https://visualvm.github.io/archive/uc/8u40/updates.xml.gz
```

æ­¥éª¤ï¼š

1. æ‰“å¼€ https://visualvm.github.io/archive/uc/8u40/updates.xml.gz ã€‚
2. åœ¨æ‰“å¼€é¡µé¢ç¬¬ä¸€è¡Œï¼Œæ‰¾åˆ° Catalog URL åé¢çš„åœ°å€ï¼Œå¹¶æ‹·è´ã€‚
3. æ‰“å¼€ VisualVM > å·¥å…· > æ’ä»¶ > è®¾ç½® > ç¼–è¾‘ã€‚
4. å°†åœ°å€æ‹·è´è¿›å»å¹¶ä¿å­˜ã€‚



## Java VisualVM å’Œ JConsole

Java VisualVM å’Œ JConsole éƒ½æ˜¯åŸºäº JMX çš„ JVM ç®¡ç†å’Œç»Ÿè®¡å·¥å…·ã€‚VisualVM ä¹Ÿæä¾› JConsole çš„æ’ä»¶ï¼Œä½†æ²¡å¿…è¦ç”¨è¿™ä¸ªæ’ä»¶ã€‚å› ä¸º VisualVM  æœ¬èº«å°±æ˜¯ JConsole çš„æ›¿ä»£ç‰ˆæœ¬ã€‚JConsole æœ‰çš„åŠŸèƒ½ VisualVM éƒ½æœ‰ã€‚



## å¦‚ä½•å¯ç”¨ JVM é£è¡Œè®°å½•å™¨å¹¶è®°å½•

JDK 8u40 å‘å¸ƒå‰ï¼ŒJVM é¡»å¼€å¯æ ‡å¿—ä½ï¼š

```bash
-XX:+UnlockCommercialFeatures
-XX:FlightRecorder
```

JDK 8u40 ä»¥åï¼Œèƒ½åœ¨è¿è¡Œæ—¶å¯ç”¨ Java Flight Recorderã€‚æ›´å¤šè¯´æ˜è¯·è§è¿™ç¯‡ [å®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘](https://cs.xieyonghui.com/java/java-flight-recorder_72.html)ã€‚

ä¸‹é¢æ˜¯å…³äºå¦‚ä½•åœ¨è¿è¡Œæ—¶å¼€å¯ Java Flight Recorder çš„è¯´æ˜ï¼š

è¾“å…¥ jcmd æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿›ç¨‹ï¼š

```bash
$ jcmd
```

è§£é” commercial_featuresï¼š

```bash
$ jcmd <pid> VM.unlock_commercial_features
```

å¯åŠ¨ä¸€ä¸ªé£è¡Œè®°å½•ï¼š

```bash
$ jcmd <pid> JFR.start
```

æ›´å¤šå…³äºå¯åŠ¨é£è¡Œè®°å½•çš„è¯¦ç»†æ§åˆ¶ï¼Œè¯·å‚è€ƒ JFR.start å‘½ä»¤çš„å¸®åŠ©ï¼š

```bash
$ jcmd <pid> help JFR.start
```

å‚è€ƒï¼š

1. [Java Flight Recorderé£è¡Œè®°å½•å™¨ç”¨æ³•å›¾è§£ (å®˜æ–¹æ–‡æ¡£è¯‘)](https://cs.xieyonghui.com/java/java-flight-recorder_72.html)
2. https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/run.htm#JFRUH176
3. https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/about.htm#JFRUH173

## è§£å†³ Java Mission Control (jmc) åœ¨ Max OS X ä¸Šä¸èƒ½å¯åŠ¨çš„é—®é¢˜

### é—®é¢˜æè¿°

æ‰“å¼€ jmc æ—¶ï¼Œå¯ä»¥æ˜¾ç¤ºå¯åŠ¨ç•Œé¢ï¼Œä½†è¿›ä¸äº† jmcã€‚

æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼šMac OS Big Sur 11.4

Java ç‰ˆæœ¬ï¼šJDK 1.8.0_181

### è§£å†³æ–¹æ¡ˆ

è¿™æ˜¯ä¸€ä¸ª bugï¼Œè¯·è§è¿™é‡Œçš„[è®¨è®º](https://stackoverflow.com/questions/48400346/java-mission-control-from-jdk-1-8-0-161-frozen-upon-startup-on-mac-os-x)ã€‚æ¢äº† JDK ç‰ˆæœ¬å°±å¯ä»¥äº†ã€‚

äº²æµ‹æ¢äº†ç‰ˆæœ¬ 1.8.0_51 å¯ä»¥è¿›å…¥ï¼Œå…¶ä»–ç‰ˆæœ¬æ²¡æœ‰è¯•è¿‡ã€‚



## æŸ¥çœ‹æœ¬æœºå®‰è£…çš„æ‰€æœ‰ Java è™šæ‹Ÿæœº

```bash
$ /usr/libexec/java_home -V
Matching Java Virtual Machines (7):
    14.0.2 (x86_64) "Oracle Corporation" - "Java SE 14.0.2" /Library/Java/JavaVirtualMachines/jdk-14.0.2.jdk/Contents/Home
    11.0.8 (x86_64) "Oracle Corporation" - "Java SE 11.0.8" /Library/Java/JavaVirtualMachines/jdk-11.0.8.jdk/Contents/Home
    1.8.201.09 (x86_64) "Oracle Corporation" - "Java" /Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home
    1.8.0_181 (x86_64) "Oracle Corporation" - "Java SE 8" /Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home
    1.8.0_51 (x86_64) "Oracle Corporation" - "Java SE 8" /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home
    1.7.0_80 (x86_64) "Oracle Corporation" - "Java SE 7" /Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home
    1.7.0_79 (x86_64) "Oracle Corporation" - "Java SE 7" /Library/Java/JavaVirtualMachines/jdk1.7.0_79.jdk/Contents/Home
/Library/Java/JavaVirtualMachines/jdk-14.0.2.jdk/Contents/Home
```

## JVM ç›‘æ§å·¥å…·åˆ—è¡¨

* [Java Mission Control (jmc)](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr002.html#BABIBBDE)

  ç”¨äº HotSpot JVM çš„æ–°çš„åˆ†æå’Œè¯Šæ–­çš„å¹³å°ï¼Œå®ƒæä¾›äº†é«˜æ€§èƒ½çš„åŸºæœ¬ç›‘æ§ã€ç®¡ç†ã€æ—¶é—´åˆ†æå’Œè¯Šæ–­å·¥å…·å¥—ä»¶ã€‚JMC æœ€å¤§é™åº¦çš„å‡å°‘äº†æ€§èƒ½å¼€é”€ã€‚

* [jcmd](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr006.html#BABEHABG)

  ç”¨äºå‘ JVM å‘é€è¯Šæ–­å‘½ä»¤è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚å¯¹äºæ§åˆ¶ Java Flight Recordings å¾ˆæœ‰ç”¨ã€‚JFR ç”¨äºå¯¹å¸¦æœ‰é£è¡Œè®°å½•äº‹ä»¶çš„ JVM å’Œ Java åº”ç”¨ç¨‹åºè¿›è¡Œæ•…éšœæ’é™¤å’Œè¯Šæ–­ã€‚

* [Java VisualVM](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr010.html#BABEEIFH)

  æ­¤å®ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªå¯è§†åŒ–ç•Œé¢ï¼Œç”¨äºåœ¨ Java è™šæ‹Ÿæœºä¸Šè¿è¡Œæ—¶æŸ¥çœ‹æœ‰å…³ Java åº”ç”¨ç¨‹åºçš„è¯¦ç»†ä¿¡æ¯ã€‚æ­¤ä¿¡æ¯å¯ç”¨äºå¯¹æœ¬åœ°å’Œè¿œç¨‹åº”ç”¨ç¨‹åºè¿›è¡Œæ•…éšœæ’é™¤ï¼Œä»¥åŠåˆ†ææœ¬åœ°åº”ç”¨ç¨‹åºã€‚

  è¿˜æä¾›äº†ä¸€äº›æ’ä»¶ä¾›è‡ªè¡Œé€‰æ‹©å®‰è£…ã€‚æ¯”å¦‚å¸¸ç”¨çš„ï¼šThread Inspectorã€Visual GCã€VisualVM-Mbeans ç­‰ã€‚

* [JConsole](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr009.html#BABDCICF)

  æ­¤å®ç”¨ç¨‹åºæ˜¯ä¸€ç§åŸºäº Java ç®¡ç†æ‰©å±• (JMX) çš„ç›‘è§†å·¥å…·ã€‚è¯¥å·¥å…·ä½¿ç”¨ Java è™šæ‹Ÿæœºä¸­çš„å†…ç½® JMX æ£€æµ‹æ¥æä¾›æœ‰å…³æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œèµ„æºæ¶ˆè€—çš„ä¿¡æ¯ã€‚

* [jmap](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr014.html#BABGAFEG)

  æ­¤å®ç”¨ç¨‹åºå¯ä»¥ä» Java è¿›ç¨‹ã€æ ¸å¿ƒæ–‡ä»¶æˆ–è¿œç¨‹è°ƒè¯•æœåŠ¡å™¨è·å–å†…å­˜æ˜ å°„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å †ç›´æ–¹å›¾ã€‚

* [jps](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr015.html#BABHCEDC)

  æ­¤å®ç”¨ç¨‹åºåˆ—å‡ºäº†ç›®æ ‡ç³»ç»Ÿä¸Šå·²æ£€æµ‹çš„ Java HotSpot VMã€‚è¯¥å®ç”¨ç¨‹åºåœ¨åµŒå…¥ VM çš„ç¯å¢ƒä¸­éå¸¸æœ‰ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä½¿ç”¨ JNI è°ƒç”¨ API è€Œä¸æ˜¯`java`å¯åŠ¨å™¨å¯åŠ¨ã€‚

* [jstack](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr016.html#BABFCHDE)

  æ­¤å®ç”¨ç¨‹åºå¯ä»¥ä» Java è¿›ç¨‹è·å– Java å’Œæœ¬æœºå †æ ˆä¿¡æ¯ã€‚åœ¨ Oracle Solaris å’Œ Linux æ“ä½œç³»ç»Ÿä¸Šï¼Œè¯¥å®ç”¨ç¨‹åºè¿˜å¯ä»¥ä»æ ¸å¿ƒæ–‡ä»¶æˆ–è¿œç¨‹è°ƒè¯•æœåŠ¡å™¨è·å–ä¿¡æ¯ã€‚

* [jstat](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr017.html#BABCDBEA)

  æ­¤å®ç”¨ç¨‹åºä½¿ç”¨ Java ä¸­çš„å†…ç½®æ£€æµ‹æ¥æä¾›æœ‰å…³æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œèµ„æºæ¶ˆè€—çš„ä¿¡æ¯ã€‚è¯¥å·¥å…·å¯ç”¨äºè¯Šæ–­æ€§èƒ½é—®é¢˜ï¼Œå°¤å…¶æ˜¯ä¸å †å¤§å°å’Œåƒåœ¾æ”¶é›†ç›¸å…³çš„é—®é¢˜ã€‚

* [jstatd å®ˆæŠ¤è¿›ç¨‹](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr033.html#CJGHGBFD)

  è¯¥å·¥å…·æ˜¯ä¸€ä¸ªè¿œç¨‹æ–¹æ³•è°ƒç”¨ (RMI) æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œå®ƒç›‘è§†å·²æ£€æµ‹ Java è™šæ‹Ÿæœºçš„åˆ›å»ºå’Œç»ˆæ­¢ï¼Œå¹¶æä¾›ä¸€ä¸ªæ¥å£ä»¥å…è®¸è¿œç¨‹ç›‘è§†å·¥å…·è¿æ¥åˆ°åœ¨æœ¬åœ°ä¸»æœºä¸Šè¿è¡Œçš„ VMã€‚

* [visualgc](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr018.html#BABCDEBE)

  æ­¤å®ç”¨ç¨‹åºæä¾›åƒåœ¾æ”¶é›†ç³»ç»Ÿçš„å›¾å½¢è§†å›¾ã€‚ä¸ ä¸€æ ·`jstat`ï¼Œå®ƒä½¿ç”¨ Java HotSpot VM çš„å†…ç½®æ£€æµ‹ã€‚

* å…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·ã€‚å¦‚ï¼š[JProfiler](https://www.ej-technologies.com/products/jprofiler/overview.html) ï¼ˆ[IDEA ä¸­ä¹Ÿæä¾›äº†ç›¸å…³æ’ä»¶](https://blog.csdn.net/wytocsdn/article/details/79258247)ï¼‰

å‚è€ƒï¼š

1. [å®˜æ–¹æ–‡æ¡£ï¼šMonitoring Tools](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr025.html)
2. [æ€§èƒ½è¯Šæ–­åˆ©å™¨ JProfiler å¿«é€Ÿå…¥é—¨å’Œæœ€ä½³å®è·µ](https://segmentfault.com/a/1190000017795841)
3. [JProfileræ€§èƒ½åˆ†æå·¥å…·è¯¦è§£](https://www.jianshu.com/p/784c60d94989)
4. [Intellij IDEAé›†æˆ JProfileræ€§èƒ½åˆ†æç¥å™¨](https://blog.csdn.net/wytocsdn/article/details/79258247)

## è¾“å…¥ exit/q å›è½¦åé€€å‡º

```java
Scanner scanner = new Scanner(System.in);
while(scanner.hasNext()) {
  String s = scanner.next().replace("\\n", "").toLowerCase();
  System.out.println(s);
  if("exit/q".contains(s)) {
    System.out.println("Exited.");
    break;
  }
}
```

## è§£å†³ Unknown channel option 'TCP_NODELAY' for channel '[id: 0xa05092f5]' çš„é—®é¢˜ã€‚

è¿™æ˜¯å› ä¸ºåœ¨ä½¿ç”¨ netty çš„ ServerBootstrap å¯åŠ¨æœåŠ¡å™¨æ—¶ï¼Œè®¾å®šäº† 

```
.option(ChannelOption.TCP_NODELAY, true)ã€‚
```

è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ `childOption(ChannelOption.TCP_NODELAY, true)`ï¼š

```java
bootstrap.group(bossGroup, workerGroup)
                .channel(NioServerSocketChannel.class)
                .childOption(ChannelOption.TCP_NODELAY, true)
                // .handler(new LoggingHandler(LogLevel.INFO))
                .childHandler(new ChannelInitializer<Channel>() {
                  ...
```



## é€šè¿‡ -Xbootclasspath æ›´æ”¹ Bootstrap ClassLoader çš„åŠ è½½ç›®å½•

æœ€å‡†ç¡®å…¨é¢çš„è§£é‡Šè¿˜æ˜¯çœ‹å®˜æ–¹æ–‡æ¡£ï¼š

https://docs.oracle.com/cd/E15289_01/JRCLR/optionx.htm#i1021218

 

## è¿è¡Œ Java ç¨‹åºæ—¶ï¼Œæ‰“å°å‡ºç±»åŠ è½½çš„è¯¦ç»†ä¿¡æ¯

åªè¦åœ¨ `Run/Debug Configurations` ä¸­çš„ `VM Options` ä¸­æ·»åŠ  `-verbose`ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š

```
...
[Opened /Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/rt.jar]
[Loaded java.lang.Object from /Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/rt.jar]
[Loaded java.io.Serializable from /Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/rt.jar]
[Loaded java.lang.Comparable from /Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/rt.jar]
[Loaded java.lang.CharSequence from /Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/rt.jar]
[Loaded java.lang.String from /Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/rt.jar]
[Loaded java.lang.reflect.AnnotatedElement from /Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/rt.jar]
...
```



## å¦‚ä½•è®©è‡ªå®šä¹‰çš„ç±»ç”± Bootstrap ClassLoader åŠ è½½

æˆ‘ä»¬çŸ¥é“ï¼ŒBootstrap Class Loader ä¼šåŠ è½½ sun.boot.class.path è™šæ‹Ÿæœºé€‰å‹æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ç±»ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ sun.boot.class.path  ç›®å½•å†…å®¹ï¼š

```
/Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/resources.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/rt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/sunrsasign.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/jsse.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/jce.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/charsets.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/lib/jfr.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home/jre/classes
```

å…¶ä¸­ `/Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home` æ˜¯æœ¬æœº `$JAVA_HOME` æŒ‡å®šçš„ç›®å½•ã€‚

å°†ä¸Šè¿° sun.boot.class.path  è¾“å‡ºå†…å®¹ç®€åŒ–ä¸€ä¸‹å¹¶é€è¡Œæ‰“å°å¦‚ä¸‹ï¼š

```
$JAVA_HOME/jre/lib/resources.jar
$JAVA_HOME/jre/lib/rt.jar
$JAVA_HOME/jre/lib/sunrsasign.jar
$JAVA_HOME/jre/lib/jsse.jar
$JAVA_HOME/jre/lib/jce.jar
$JAVA_HOME/jre/lib/charsets.jar
$JAVA_HOME/jre/lib/jfr.jar
$JAVA_HOME/jre/classes
```

ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼šåªç”¨å°†æœŸæœ›è®© Bootstrap ClassLoader åŠ è½½çš„è‡ªå®šä¹‰ç±»æ”¾å…¥ `$JAVA_HOME/jre/classes` ç›®å½•ä¸­å³å¯ã€‚

ç¬¬äºŒä¸ªæ–¹æ³•ï¼šè®¾ç½® -Xbootclasspath è¿™ä¸ªè™šæ‹Ÿæœºé€‰å‹ï¼ˆå‘½ä»¤å¸®åŠ©ï¼Œè¯·è§[å®˜æ–¹æ–‡æ¡£](https://docs.oracle.com/cd/E15289_01/JRCLR/optionx.htm#i1021218)ï¼‰æ¯”å¦‚ï¼š

```
-Xbootclasspath:/a <path-to-your-custom-class>
```



## Assertions.assertEquals å’Œ assertSame çš„åŒºåˆ«

ä¸¤è€…éƒ½æ˜¯ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼›ä¸åŒç‚¹æ˜¯ï¼š

* assertEquals ç”¨çš„æ˜¯ equals æ¯”è¾ƒï¼›

* assertSame  ç”¨çš„æ˜¯ == æ¯”è¾ƒã€‚

å¦‚æœä¸¤ä¸ªå¯¹è±¡ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸º nullï¼Œæˆ–ä¸¤è€…éƒ½ä¸º nullï¼›ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è¿”å› falseã€‚

assertEquals:

```java
static boolean objectsAreEqual(Object obj1, Object obj2) {
  if (obj1 == null) {
    return (obj2 == null);
  }
  return obj1.equals(obj2);
}
```

assertSame :

```java
static void assertSame(Object expected, Object actual, String message) {
  if (expected != actual) {
    failNotSame(expected, actual, message);
  }
}
```

**å› æ­¤ï¼šå¯¹äºæ²¡æœ‰é‡å†™è¿‡ equals æ–¹æ³•çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œè°ƒç”¨é‚£ä¸ªéƒ½ä¸€æ ·ã€‚å¯¹äºé‡å†™è¿‡ equals  æ–¹æ³•çš„ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„åˆ¤æ–­ç»“æœã€‚**



## å¦‚ä½•åœ¨ gradle ä¸­è®¾ç½® JDK ç‰ˆæœ¬

build.gradle:

```groovy
...
java {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
}
...
```

[å®˜æ–¹æ–‡æ¡£](https://docs.gradle.org/6.8.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html#org.gradle.api.tasks.compile.JavaCompile:sourceCompatibility)



## java: æ— æ•ˆçš„ç›®æ ‡å‘è¡Œç‰ˆ: 11

è§£å†³æ–¹æ¡ˆï¼š

1. ç¬¬ä¸€ç§æ–¹å¼ï¼šåœ¨ `build.gradle` ä¸­æŒ‡å®šï¼š

   ```groovy
   ...
   java {
       sourceCompatibility JavaVersion.VERSION_1_8
       targetCompatibility JavaVersion.VERSION_1_8
   }
   ...
   ```

   è¯´æ˜ï¼š

   * `sourceCompatibility` æ§åˆ¶çš„å°±æ˜¯ `Project Structure > Project Settings > Project` ä¸­çš„ `Project languange level` 

   * `targetCompatibility` æ§åˆ¶çš„æ˜¯ `Preferences > â€¦  > Java Compiler` ä¸­çš„ `Project bytecode version`

2. ç¬¬äºŒç§æ–¹å¼ï¼šæ‰‹åŠ¨è®¾ç½®

   é¦–å…ˆï¼Œæ‰“å¼€ `Project Structure > Project Settings > Project`ï¼Œçœ‹çœ‹ `Project SDK` å’Œ `Project languange level` æ˜¯å¦åŒ¹é…ã€‚

   å…¶æ¬¡ï¼šæ‰“å¼€ IDEA çš„ `Preferences`ï¼Œæ‰¾åˆ° `Java Compiler`ï¼Œæ›´æ”¹ `Project bytecode version`ã€‚




## IPV6 æœ€å¤§å­—ç¬¦ä¸²é•¿åº¦

**45ä¸ªå­—ç¬¦**ï¼Œæ•°æ®åº“è®¾è®¡æ—¶å­˜å‚¨IPv6éœ€è¦ varchar(45)ã€‚

å…¶ä¸­ï¼š`0000:0000:0000:0000:0000` æœ‰ `8 * 4 + 7 = 39` ä¸ªå­—ç¬¦ã€‚

å¯¹äº [IPv4-Mapped IPv6 Address](https://datatracker.ietf.org/doc/html/rfc4291#section-2.5.5.2)ï¼ŒåŠ èµ·æ¥å°±æ˜¯ 45ã€‚

```
0000:0000:0000:0000:0000:ffff:192.168.100.228
```

åœ¨ Linuxä¸Šï¼Œè¯·å‚è§å¸¸é‡ `INET6_ADDRSTRLEN` ï¼ˆè¯·å‚é˜…man inet_ntopï¼‰ï¼š

```
#define INET6_ADDRSTRLEN 46
```

æœ€åä¸€ä¸ªå­—ç¬¦ç”¨äºç»ˆæ­¢ NULLï¼Œæ‰€ä»¥æœ€å¤§é•¿åº¦ä¸º 45ã€‚



## ä¸ºå·²å­˜åœ¨çš„å¤šæ¨¡å—é¡¹ç›®æ·»åŠ ä¸€ä¸ªæ–°çš„ SpringBoot å­æ¨¡å— ğŸš€

æ“ä½œæ­¥éª¤ï¼š

1. åœ¨ IDEA ä¸­ï¼Œç‚¹å‡»é¡¹ç›®æ ¹è·¯å¾„ï¼Œå³é”®é€‰æ‹© `New > Module...`

2. åœ¨å‡ºç°çš„ `New Module` å¼¹å‡ºæ¡†ä¸­ï¼Œé€‰æ‹© `Spring Initializr`ï¼Œç„¶åæŒ‰å‘å¯¼åˆ›å»ºå¥½å­æ¨¡å—ï¼ˆåç»­æ“ä½œç•¥ï¼‰ã€‚

3. å­æ¨¡å—ï¼ˆå‡è®¾æ¨¡å—åç§°å« `xxx-app`ï¼‰è¢«æ·»åŠ åˆ° Project ä¸­äº†ï¼Œä½†æ˜¯å®ƒé»˜è®¤ä½œä¸ºå’ŒåŸ Project å¹³çº§çš„é¡¹ç›®äº†ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›æ‰‹åŠ¨æ“ä½œï¼š

4. ç‚¹å‡» Gradle ä¾§è¾¹æ ï¼Œæ‰¾åˆ°åˆšåˆšåˆ›å»ºå¥½çš„æ¨¡å—åç§°ï¼Œåˆ é™¤æ‰ï¼Œç„¶åç‚¹å‡»ä¸Šé¢çš„ â€œ+â€ æŒ‰é’®ï¼Œå°†å­æ¨¡å—æ·»åŠ è¿›æ¥ã€‚

5. æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•çš„ `settings.gradle` æ–‡ä»¶ï¼Œæ‰¾åˆ° include(â€¦)ï¼Œ å°†æ¨¡å—åæ·»åŠ è¿›å»ï¼š

   ```java
   include('app', 'list', 'utilities', 'xxx-app')
   ```

ç°åœ¨ï¼Œç‚¹å‡» â€œ`Reload All Gradle Projec`tâ€ å³å¯ï¼ˆåœ¨ IDEA çš„ Gradle ä¾§è¾¹æ ä¸­ï¼‰ã€‚



## Java ä¸­çš„ char å å‡ ä¸ªå­—èŠ‚ï¼Ÿ

2 ä¸ªå­—èŠ‚ï¼ˆæˆ– 16 ä½ï¼‰ã€‚ç±»å‹ char åœ¨ Java ä¸­ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚

å®ƒ**åœ¨å†…å­˜ä¸­çš„ç¼–ç **æ˜¯ç”¨çš„ unicode ç¼–ç ã€‚



## é€šè¿‡åç§°è·å¾—ä¸€æŠŠé”

```java
private final ConcurrentHashMap<String, Object> parallelLockMap;
protected Object getClassLoadingLock(String className) {
  Object lock = this;
  if (parallelLockMap != null) {
    Object newLock = new Object();
    lock = parallelLockMap.putIfAbsent(className, newLock);
    if (lock == null) {
      lock = newLock;
    }
  }
  return lock;
}
```

æ‘˜æŠ„è‡ªï¼š`ClassLoader.getClassLoadingLock`



## å…³äº @implSpec æ³¨é‡Š

```java
     * @implSpec
     * This method invokes {@link #readNBytes(int)} with a length of
     * {@link Integer#MAX_VALUE}.
		public byte[] readAllBytes() throws IOException {
        return readNBytes(Integer.MAX_VALUE);
    }
```

## ä¸åŒæ‘˜è¦ç®—æ³•  CPU å ç”¨ç‡æ¯”è¾ƒ

![img](/Users/ktgu/Pictures/typora/131646500458774.jpg) 

ç»“è®ºï¼š

- æ•°æ®æ‘˜è¦ç®—æ³•çš„å¤„ç†æ˜¯å¾ˆå¿«çš„ï¼Œåœ¨ä¸€èˆ¬é…ç½®çš„PCæœºä¸Šä½¿ç”¨MD5ç®—æ³•ï¼Œå¤„ç†1Gçš„æ–‡ä»¶æ•°æ®åªéœ€20-30ç§’ï¼ˆæœ‰äº›ä¸“ç”¨è®¾å¤‡å£°ç§°è¾¾ 3GB/ç§’ï¼‰ï¼Œä¸ä¼šå¯¹åº”ç”¨æˆ–æœºå™¨å¸¦æ¥è¿‡å¤šè´Ÿè½½ã€‚
- MD5ã€SHA1è™½ç„¶è¢«å‘ç°å­˜åœ¨ç¼ºé™·ï¼ˆç¢°æ’ï¼‰ï¼Œä½†åœ¨è¿‘å‡ å¹´å†…ï¼Œä»ç„¶å¯ä»¥å¤§é‡ä½¿ç”¨ã€‚
- SHA256/384/512 çš„é€Ÿåº¦è¾ƒæ…¢ï¼Œå¯ä»¥ç”¨äºå°‘é‡æ•°æ®æ‘˜è¦ï¼Œç›®å‰ä¸é€‚åˆç”¨äºå¤§æ–‡ä»¶æ ¡éªŒã€‚
- MD5è®¡ç®—é€Ÿåº¦è¦æ˜æ˜¾ä¼˜äºCRC32ã€‚

å‚è€ƒï¼š

1. https://blog.csdn.net/xiaofei0859/article/details/52683533

## å…³äº ClassLoader â€œåŒäº²å§”æ‰˜â€ çš„ç¿»è¯‘é—®é¢˜

è§‚ç‚¹ï¼š

1. è‹±æ–‡ä¸å¥½çš„äººä¸è¦ç¿»è¯‘è®¡ç®—æœºä¹¦ç±ã€‚
2. è®¡ç®—æœºä¸å¥½çš„äººä¸è¦ç¿»è¯‘è‹±æ–‡è®¡ç®—æœºä¹¦ç±ã€‚
3. è‹±æ–‡å¥½çš„äººä¸è¦çœ‹ç¿»è¯‘çš„è®¡ç®—æœºä¹¦ç±ã€‚

çœ‹ ClassLoader æ—¶ï¼Œå‡ ä¹æ¯ç¯‡æ–‡ç« éƒ½è¦æåˆ°â€œåŒäº²å§”æ‰˜â€œåŠ è½½æ¨¡å¼ã€‚è™½ç„¶çœ‹æ‡‚äº†åŸç†ï¼Œä½†ç¼ºä»ç„¶è‡ªå·±æ²¡æ‡‚ã€‚å§‹ç»ˆæ€€ç–‘è‡ªå·±æ²¡æœ‰çœ‹æ‡‚ï¼Œå› ä¸ºå¯¹ â€œåŒäº²å§”æ‰˜â€  è¿™ä¸ªåè¯æ¦‚å¿µçš„ç†è§£ä»ç„¶æ˜¯äº‘é‡Œé›¾é‡Œã€‚

å®é™…ä¸Šï¼Œè¿™åªæ˜¯ä¸€ä¸ªç¿»è¯‘é—®é¢˜ã€‚[è‹±æ–‡åŸæ–‡](https://docs.oracle.com/javase/tutorial/ext/basics/load.html)

**The Java Class Loading Mechanism**

> The Java platform uses a delegation model for loading classes. **The basic idea is that every class loader has a "parent" class loader.** When loading a class, a class loader first "delegates" the search for the class to its parent class loader before attempting to find the class itself.

æŠŠ Parents ç¿»è¯‘æˆâ€œåŒäº²â€ï¼Œæˆ‘ä»–å¦ˆçš„çœŸçš„æœäº†ï¼Œè¿™ä¹ˆå¤šå¹´å®³è‹¦äº†å¤šå°‘äººï¼Ÿå›æƒ³æœ€æ—©çœ‹åˆ°â€œåŒäº²å§”æ´¾æ¨¡å‹â€æ—¶ï¼Œé¡¿æ—¶æ„Ÿåˆ°å¥½é«˜çº§ï¼Œå¥½éš¾æ‡‚çš„æ ·å­ï¼Œè¿™æ ·åŠ¿å¿…ä¼šç»™æ–°å­¦è€…é€ æˆå¿ƒç†ä¸Šçš„éšœç¢ã€‚è¯»å®Œä»¥åï¼Œç³Ÿç³•çš„ç¿»è¯‘æ›´æ˜¯ç»™æ–°å­¦è€…å¸¦æ¥å¿ƒç†ä¸Šçš„åˆ›ä¼¤ã€‚

åŒäº²å®åœ¨æ˜¯å¤ªè¯¯å¯¼äººäº†ï¼Œçˆ¶æ¯åŠ åœ¨ä¸€èµ·å«åŒäº²ã€‚ä½† ClassLoader ç±»åŠ è½½æœºåˆ¶é‡Œï¼Œè¯´çš„æ˜¯çˆ¶æ¯å—ï¼Ÿé¦–å…ˆå°±æ²¡æœ‰å¹³çº§çš„çˆ¶ + æ¯çš„æ¦‚å¿µï¼›è€Œä¸”è¿˜æœ‰çˆ·çˆ·è¾ˆçš„æ¦‚å¿µå‘¢ã€‚

å“ªæ€•ä½ ç¿»ä¸€ä¸ªå¾ˆåœŸçš„ä½†æ¯”è¾ƒè´´åˆ‡çš„åå­—ä¹Ÿå¥½ï¼Œæ¯”å¦‚ï¼šå‘ä¸Šã€æº¯æºã€éƒ½å¯ä»¥ã€‚æˆ–è€…çˆ¶çº§ä»£ç†ä»€ä¹ˆçš„ã€‚

é¢å‘å¯¹è±¡é‡Œæœ‰çˆ¶ç±»å­ç±»ï¼Œè¿˜å¥½æ²¡æœ‰ç¿»è¯‘æˆâ€œ åŒäº²â€ç±»ã€‚å› ä¸ºä¸€èˆ¬è¯´çˆ¶ç±»è‹±æ–‡é‡Œéƒ½æ˜¯ Parent Class ï¼Œç”¨çš„æ˜¯å•æ•°ï¼Œæ‰€ä»¥å¥½ç¿»è¯‘ã€‚éº»ç—¹åˆ°äº† ClassLoader è¿™é‡Œï¼Œè‹±æ–‡é‡Œç”¨äº†å¤æ•°ï¼Œå°±ä¸çŸ¥é“å¦‚ä½•ç¿»è¯‘äº†ã€‚è‹±æ–‡ä¸å¥½ï¼Œå¯¹ JVM ç†è§£ä¸æ·±ä¸æ˜¯ä½ çš„é”™ï¼Œä½†ä½ å‡ºä¹¦è¯¯å¯¼åå­¦å°±æ˜¯ä½ çš„é”™äº†ã€‚

çŸ¥ä¹çœ‹åˆ°æœ‰äººå»ºè®®ç¿»è¯‘æˆï¼šçˆ¶è¾ˆä»£ç†ã€ä¸Šæº¯å§”æ‰˜ éƒ½å¬ä¸é”™çš„ã€‚å“ªæ€•ä½ ç”¨â€œå‘ä¸Šå§”æ‰˜â€éƒ½å¯ä»¥ï¼Œè‡³å°‘ä¸ä¼šé€ æˆæ›²è§£ã€‚



# 7ã€ğŸ³ Docker

## åœ¨åŸºäº debian çš„å®¹å™¨ä¸­å®‰è£… vim

ä»¥ä¸‹ä»¥å®‰è£… vim ä¸ºä¾‹ï¼š

```sh
# é¦–å…ˆå¾—ä»¥äº¤äº’æ–¹å¼è¿›å…¥å®¹å™¨
$ docker exec -it xxx bash

# å¤‡ä»½æ—§çš„ä¸‹è½½æºï¼Œå¹¶æ·»åŠ å›½å†…ç½‘æ˜“çš„ä¸‹è½½æº
# NOTE: ä¹Ÿå¯ä»¥ä¸ç”¨æ›´æ”¹ï¼Œå®˜æ–¹é»˜è®¤çš„ä¸‹è½½é€Ÿåº¦ä¹ŸæŒºå¿«çš„
$ mv /etc/apt/sources.list /etc/apt/sources.list.bak
$ echo "deb http://mirrors.163.com/debian/ jessie main non-free contrib" >/etc/apt/sources.list
$ echo "deb http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib" >>/etc/apt/sources.list
$ echo "deb-src http://mirrors.163.com/debian/ jessie main non-free contrib" >>/etc/apt/sources.list
$ echo "deb-src http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib" >>/etc/apt/sources.list

# Retrieve new lists of packages
$ apt-get update 
$ apt-get install -y vim
```



### å®‰è£… portia

```sh
docker run \
	-v /data/portia:/app/data/projects:rw \
	-p 19001:9001 \
	--restart always \
	--name portia \
	scrapinghub/portia
```



## åˆ¶ä½œé•œåƒæ—¶å‡ºç° unable to initialize frontend: Dialog å¼‚å¸¸

### 1ã€é—®é¢˜æè¿°

åˆ¶ä½œé•œåƒæ—¶å‡ºç°å¼‚å¸¸ï¼š`unable to initialize frontend: Dialog`

```
debconf: unable to initialize frontend: Dialogdebconf: (TERM is not set, so the dialog frontend is not usable.)debconf: falling back to frontend: Readlinedebconf: unable to initialize frontend: Readlinedebconf: (This frontend requires a controlling tty.)debconf: falling back to frontend: Teletype
```

åŸå› æ˜¯å› ä¸ºä½¿ç”¨apt-getå®‰è£…ä¾èµ–æ—¶ï¼Œå¯èƒ½ä¼šæœ‰å¯¹è¯æ¡†ï¼Œåˆ¶ä½œé•œåƒæ—¶å¦‚æœæ²¡æœ‰å¯¹å¯¹è¯æ¡†å“åº”ä¼šå¯¼è‡´å¤±è´¥ã€‚

### 2ã€è§£å†³æ–¹æ¡ˆ

åœ¨å‡ºé”™æŒ‡ä»¤ä¹‹å‰åŠ ä¸Šï¼š

```docker
ENV DEBIAN_FRONTEND noninteractive
```



## è§£å†³ openjdk8-jdk-alpine é•œåƒé»˜è®¤æ²¡æœ‰å®‰è£…å­—ä½“è€Œå¯¼è‡´ Kaptcha ç”ŸæˆéªŒè¯ç å¤±è´¥çš„é—®é¢˜

### 1ã€é—®é¢˜æè¿°

å½“æˆ‘ä»¬é€‰æ‹© `8-jdk-alpine` ä½œä¸ºè¿è¡Œ `java` é¡¹ç›®çš„é•œåƒæ—¶ï¼Œå¦‚æœ java é¡¹ç›®ä¸­ä½¿ç”¨åˆ° [Kaptcha](https://mvnrepository.com/artifact/com.github.penggle/kaptcha/2.3.2) è¿™ä¸ªåº“æ¥ç”Ÿæˆå›¾å½¢éªŒè¯ç ï¼Œå°±ä¼šå‡ºç°å› ä¸ºæ‰¾ä¸åˆ°å­—ä½“è€Œå¯¼è‡´çš„å¼‚å¸¸ã€‚

è¿™æ˜¯å› ä¸º `8-jdk-alpine` é•œåƒä¸­æ²¡é»˜è®¤æœ‰å®‰è£…å­—ä½“å¯¼è‡´çš„ã€‚

### 2ã€è§£å†³æ–¹æ¡ˆ

åœ¨ `Dockerfile` æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å‘½ä»¤ï¼Œå®‰è£…å¿…è¦çš„ä¾èµ–ï¼š

```docker
RUN apk add --no-cache ttf-dejavu fontconfig
```



## å®‰è£… gitlab

```bash
$ docker run \
	-d \
  -p 18081:80 \
  --privileged=true \
  --restart always \
  --volume /data/gitlab/config:/etc/gitlab:Z \
  --volume /data/gitlab/logs:/var/log/gitlab:Z \
  --volume /data/gitlab/data:/var/opt/gitlab:Z \
  --name gitlab \
  beginor/gitlab-ce:latest
```



# 8ã€ğŸ§ Linux

## æ‰§è¡Œ crontab -l  å‘½ä»¤æç¤ºï¼šno crontab for root

è¿™æ˜¯å› ä¸º liunx æœåŠ¡å™¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ crontab ï¼Œè¿˜æ²¡æœ‰ç”Ÿæˆå¯¹åº”çš„æ–‡ä»¶å¯¼è‡´çš„ã€‚

è§£å†³æ–¹æ¡ˆï¼š

è¾“å…¥ crontab -e å‘½ä»¤ï¼ŒæŒ‰ ESCï¼ŒæŒ‰ :wq å›è½¦é€€å‡ºã€‚å†æ‰§è¡Œ crontab -l å°±ä¸æç¤ºäº†ã€‚



## æŸ¥çœ‹ç£ç›˜å ç”¨ç©ºé—´

```bash
du -ah --max-depth=1 ./
```



## linux æœåŠ¡å™¨ä¸Šæ¯å¤© 3 ç‚¹æ‰§è¡Œå‘½ä»¤

è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç¼–è¾‘è®¡åˆ’ä»»åŠ¡

```bash
$ crontab -e
```

åœ¨æ‰“å¼€çš„ç¼–è¾‘å™¨ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```bash
# æ¯å¤© 3 ç‚¹ é‡å¯æœåŠ¡
0 3 * * * echo "Restarting server." >> /tmp/test.txt
0 3 * * * /data/shuliao/bin/server.sh restart
```

 æŒ‰ :wq ä¿å­˜é€€å‡ºã€‚



## docker ä¸­æ„å»º vue å‰ç«¯ä»£ç åæ‹·è´åˆ° nginx ç›®å½•ä¸­

```sh
# jenkinså®¹å™¨é»˜è®¤æ„å»ºç›®å½•å­˜æ”¾åœ¨ï¼š/var/jenkins_home/workspace/ä¸­
# nginxå®¹å™¨å­˜æ”¾é™æ€æ–‡ä»¶çš„ç›®å½•ä¸ºï¼š/usr/share/nginx/html
# å› æ­¤ï¼Œjenkins æ„å»ºå¥½ vue çš„é™æ€æ–‡ä»¶åï¼Œéœ€è¦åœ¨å®¹å™¨å†…ç›´æ¥æ‹·è´åˆ° nginx å®¹å™¨æŸä¸ªæ–‡ä»¶å¤¹ä¸‹çš„å‘½å¦‚ä¸‹ï¼š
# è¿›å…¥ jenkins å®¹å™¨
$ docker exec -it jenkins sh
# æ‹·è´ dist ç›®å½•åˆ° nginx å®¹å™¨çš„ /usr/share/nginx/html/url-rescuer-client ç›®å½•ä¸­
$ docker cp /var/jenkins_home/workspace/url-rescuer-client/client/dist nginx:/usr/share/nginx/html/url-rescuer-client
# é€€å‡º jenkins å®¹å™¨ï¼Œç”±äº nginx å®¹å™¨ç›®å½• /usr/share/nginx/html æ˜ å°„åˆ°äº†å®¿ä¸»æœºçš„ /data/nginx/www
# å› æ­¤è¿›å…¥å®¿ä¸»æœº /data/nginx/www ç›®å½•çœ‹ä¸Šè¿°æ‹·è´æ“ä½œæ˜¯å¦æˆåŠŸ
$ cd /data/nginx/www; ls
```



## æŸ¥çœ‹ OpenJDK å®‰è£…è·¯å¾„

```bash
$ whereis java
java: /usr/bin/java /usr/lib/java /etc/java /usr/share/java /usr/share/man/man1/java.1.gz

$ ll /usr/bin/java
lrwxrwxrwx 1 root root 22 7æœˆ   7 21:39 /usr/bin/java -> /etc/alternatives/java

$ ll /etc/alternatives/java
lrwxrwxrwx 1 root root 73 7æœˆ   7 21:39 /etc/alternatives/java -> /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64/jre/bin/java
```

ä»è¿‡ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬çŸ¥é“ `OpenJDK` è¢«å®‰è£…åˆ° `/usr/lib/jvm/` ç›®å½•ä¸‹äº†ã€‚

### ç»Ÿè®¡æ•°å­—åå†æ’åºï¼ˆå€’åºï¼‰

```bash
$ netstat -ant|awk '{print $6}'|sort|uniq -c|sort -nr
      9 LISTEN
      8 ESTABLISHED
      1 Foreign
      1 established)
```

### ç»Ÿè®¡ TCP çŠ¶æ€çš„ä¸ªæ•°

```bash
$ netstat -ant|awk '{print $6}'|sort|uniq -c
      1 CLOSE_WAIT
      1 established)
      7 ESTABLISHED
      1 Foreign
      9 LISTEN
```

## è®¾ç½®æ—¶é—´å’Œæ—¶åŒº

```bash
#Control the system time and date
#ä½¿ç”¨timedatectlå‘½ä»¤ï¼Œæ§åˆ¶ç³»ç»Ÿæ—¶é—´å’Œæ—¥æœŸ
#åˆ—å‡ºå½“å‰æ—¶é—´ç›¸å…³çš„ä¿¡æ¯
timedatectl

#åˆ—å‡ºæ‰€æœ‰æ—¶åŒº
timedatectl list-timezones

#ä¿®æ”¹æ—¶åŒºä¸ºä¸Šæµ·
timedatectl set-timezone Asia/Shanghai

#æ ¡å‡†æ—¶é—´
yum -y install ntp
#é€šè¿‡é˜¿é‡Œäº‘æ—¶é—´æœåŠ¡å™¨æ ¡å‡†æ—¶é—´
ntpdate ntp1.aliyun.com
```

## å¦‚ä½•é‡å¯ Linuxç³»ç»Ÿ

```bash
1.reboot æ™®é€šé‡å¯
2.shutdown -r now ç«‹åˆ»é‡å¯(rootç”¨æˆ·ä½¿ç”¨)
3.shutdown -r 10 è¿‡10åˆ†é’Ÿè‡ªåŠ¨é‡å¯(rootç”¨æˆ·ä½¿ç”¨)
4.shutdown -r 20:35 åœ¨æ—¶é—´ä¸º20:35æ—¶å€™é‡å¯(rootç”¨æˆ·ä½¿ç”¨)
```

## æ·»åŠ è½¯è¿æ¥ï¼ŒæŒ‡å‘ç›®å½•

```bash
#åˆ›å»º/var/test å¼•å‘/var/www/testæ–‡ä»¶å¤¹ 
$ ln â€“s /var/www/test /var/test 

#æ·»åŠ è½¯è¿æ¥ï¼šln -s æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ (ç›®æ ‡ç›®å½•ä¸‹çš„åŒåæ–‡ä»¶å¤¹ -> æºæ–‡ä»¶)
$ ln -s /usr/local/mycms/upload/ /usr/local/mycms/webapps/mycms/WEB-INF/static/
```

## æŸ¥è¯¢æœ¬æœº IP

```bash
$ curl -s <http://myip.ipip.net>
```



## âœ”ï¸ å¦‚ä½•åˆ·æ–°/é‡ç½®mac monsterey ç³»ç»Ÿçš„ DNS

```bash
$ sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder
```

å‚è€ƒï¼š[How to Reset and Flush DNS Cache in macOS Monterey 12](https://www.catalinaosx.com/how-to-reset-and-flush-dns-cache-in-macos-monterey-12-fixed/) [Fixed\]

## Debian9 å®‰è£… curl

```bash
#é¦–å…ˆè¦æ›´æ–°
$ apt-get update
$ apt-get upgrade

#å†å®‰è£…curl
$ apt-get install curl
```

## CentOS ä¸Šå®‰è£…åŠä½¿ç”¨ besttrace

```bash
wget <https://cdn.ipip.net/17mon/besttrace4linux.zip>
unzip besttrace*
chmod +x besttrace
#ç™»é™†ipip.netæˆ–ip138.comçœ‹æœ¬æœºip
./besttrace æœ¬æœºip
```

## æ²¡æœ‰ jpsã€jmap å‘½ä»¤æ€ä¹ˆåŠï¼Ÿ

ä¹‹å‰å¯èƒ½å®‰è£…çš„æ˜¯ `java-1.8.0-openjdk.x86_64` (**OpenJDK Runtime Environment 8**)ï¼Œä»–æ˜¯ä¸ªè¿è¡Œæ—¶ã€‚

è§£å†³æ–¹æ¡ˆæ˜¯ï¼šåªéœ€è¦å†å®‰è£…åŒç‰ˆæœ¬çš„ `java-1.8.0-openjdk-devel.x86_64` (**OpenJDK 8 Development Environment**) å³å¯ã€‚

```bash
$ yum install -y java-1.8.0-openjdk-devel.x86_64
```



## TODO jcmd å‘½ä»¤

`jcmd` å‘½ä»¤ç”¨æ¥å‘ `JVM` å‘é€è¯Šæ–­å‘½ä»¤è¯·æ±‚ã€‚è¿™äº›è¯·æ±‚å¯¹äºæ§åˆ¶ Java Flight Recordingsã€æ•…éšœæ’é™¤ä»¥åŠè¯Šæ–­ JVM å’Œ Java åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚è¯¥å‘½ä»¤å¿…é¡»ç”¨åœ¨å’Œ JVM åŒä¸€å°æœºå™¨ä¸Šï¼Œå¹¶ä¸”å…·æœ‰ä¸å¯åŠ¨ JVM ç›¸åŒçš„æœ‰æ•ˆç”¨æˆ·å’Œç»„æ ‡è¯†ç¬¦ã€‚

> The `jcmd` utility is used to send diagnostic command requests to the JVM, where these requests are useful for controlling Java Flight Recordings, troubleshoot, and diagnose JVM and Java Applications. It must be used on the same machine where the JVM is running, and have the same effective user and group identifiers that were used to launch the JVM.

### å‘½ä»¤è¯­æ³•

```
jcmd [-l|-h|-help]
jcmd pid|main-class PerfCounter.print
jcmd pid|main-class -f filename
jcmd pid|main-class command[ arguments]
```

### æŸ¥çœ‹ jcmd å¸®åŠ©

```bash
$ jcmd -h
# æˆ–è€…
$ jcmd -help
```

### æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨

```bash
# å‚æ•° -l ç”¨äºåˆ—å‡ºå½“å‰ä¸»æœºä¸Šçš„æ‰€æœ‰ JVM è¿›ç¨‹åˆ—è¡¨
$ jcmd -l
6 /usr/share/jenkins/jenkins.war
17694 sun.tools.jcmd.JCmd
```

ç©ºæ ¼å‰é¢æ˜¯è¿›ç¨‹çš„ `pid`ï¼Œåé¢è·Ÿç€è¿›ç¨‹çš„ `main class`ã€‚

### æŸ¥çœ‹è¿›ç¨‹å¯ç”¨çš„å‘½ä»¤

```bash
# è¿™é‡Œæ˜¯å‘½ä»¤åè·Ÿ pidï¼Œä¹Ÿå¯ä»¥æŒ‡å®š main classï¼Œä½†å»ºè®®ä½¿ç”¨ pidï¼Œå› ä¸ºæ›´æ–¹ä¾¿
$ jcmd 6 help
# æˆ–è€… jcmd /usr/share/jenkins/jenkins.war help
6:
VM.unlock_commercial_features
JFR.configure
JFR.stop
JFR.start
JFR.dump
JFR.check
VM.native_memory
ManagementAgent.stop
ManagementAgent.start_local
ManagementAgent.start
VM.classloader_stats
GC.rotate_log
Thread.print
GC.class_stats
GC.class_histogram
GC.heap_dump
GC.finalizer_info
GC.heap_info
GC.run_finalization
GC.run
VM.uptime
VM.dynlibs
VM.flags
VM.system_properties
VM.command_line
VM.version
help

For more information about a specific command use 'help <command>'.
```

å‘½ä»¤æ‰§è¡Œåï¼Œä¼šå°†æŒ‡å®šè¿›ç¨‹æ‰€æœ‰å¯ç”¨çš„å‘½ä»¤éƒ½æ‰“å°å‡ºæ¥ï¼Œè¿™äº›å‘½ä»¤æä¾›äº†å„ç§è¯Šæ–­åŠŸèƒ½ã€‚

### æ‰“å°æ‰€æœ‰å‘½ä»¤çš„ç®€å•è¯´æ˜

```bash
$ jcmd 6 help -all help
6:
VM.native_memory
	Print native memory usage

ManagementAgent.stop
	Stop remote management agent.

ManagementAgent.start_local
	Start local management agent.

ManagementAgent.start
	Start remote management agent.

VM.classloader_stats
	Print statistics about all ClassLoaders.

GC.rotate_log
	Force the GC log file to be rotated.

Thread.print
	Print all threads with stacktraces.

GC.class_stats
	Provide statistics about Java class meta data. Requires -XX:+UnlockDiagnosticVMOptions.

GC.class_histogram
	Provide statistics about the Java heap usage.

GC.heap_dump
	Generate a HPROF format dump of the Java heap.

GC.finalizer_info
	Provide information about Java finalization queue.

GC.heap_info
	Provide generic Java heap information.

GC.run_finalization
	Call java.lang.System.runFinalization().

GC.run
	Call java.lang.System.gc().

VM.uptime
	Print VM uptime.

VM.dynlibs
	Print loaded dynamic libraries.

VM.flags
	Print VM flag options and their current values.

VM.system_properties
	Print system properties.

VM.command_line
	Print the command line used to start this VM instance.

VM.version
	Print JVM version information.

help
	For more information about a specific command use 'help <command>'. With no argument this will show a list of available commands. 'help all' will show help for all commands.
```

### æŸ¥çœ‹å…·ä½“å‘½ä»¤çš„å¸®åŠ©

å¦‚æœæƒ³çŸ¥é“æ¯ä¸ªå‘½ä»¤çš„åŠŸèƒ½ã€æƒé™å’Œä½¿ç”¨è¯­æ³•ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ï¼š

```bash
$ jcmd 6 help Thread.print
6:
Thread.print
Print all threads with stacktraces.

Impact: Medium: Depends on the number of threads.

Permission: java.lang.management.ManagementPermission(monitor)

Syntax : Thread.print [options]

Options: (options must be specified using the <key> or <key>=<value> syntax)
	-l : [optional] print java.util.concurrent locks (BOOLEAN, false)
```

### æ‰“å°çº¿ç¨‹ä¿¡æ¯

è¯¥å‘½ä»¤ç”¨äºè¾“å‡ºå¸¦å †æ ˆè·Ÿè¸ªçš„çº¿ç¨‹ä¿¡æ¯ã€‚

```bash
$ jcmd 6 Thread.print
6:
2021-09-04 17:05:21
Full thread dump OpenJDK 64-Bit Server VM (25.212-b04 mixed mode):

"FilePath.localPool [#4390]" #49845 daemon prio=5 os_prio=0 tid=0x000055e896622000 nid=0x4610 waiting on condition [0x00007ff35c38e000]
   java.lang.Thread.State: TIMED_WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait for  <0x0000000087045e50> (a java.util.concurrent.SynchronousQueue$TransferStack)
	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
	at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
	at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
	at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)

"Attach Listener" #49806 daemon prio=9 os_prio=0 tid=0x000055e895caf000 nid=0x4354 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
...
```

è¾“å‡ºçº¿ç¨‹ç»“æœä¼šæ¯”è¾ƒå†—é•¿ï¼Œå»ºè®®æ‰“å°åˆ°æ–‡ä»¶ä¸­ï¼š

```bash
$ jcmd 6 Thread.print > thread-dump.txt
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ `jstack` å‘½ä»¤è¾“å‡º `thread` ä¿¡æ¯ï¼Œä»¥ä¸‹å‘½ä»¤å’Œä¸Šé¢ç­‰æ•ˆï¼š

```bash
$ jstack 6 > thread-dump.txt
```

`jstack` å‘½ä»¤è¿˜å¯ä»¥ç”¨äºæ‰“å°è¿œç¨‹ä¸»æœºçš„ `thread` ä¿¡æ¯ï¼Œæ›´å¤šä¿¡æ¯è¯·å‚è€ƒ [jstack å‘½ä»¤å¸®åŠ©æ–‡æ¡£](https://docs.oracle.com/javase/7/docs/technotes/tools/share/jstack.html)ã€‚

### å †ä¿¡æ¯è½¬å‚¨ï¼ˆheap dumpï¼‰

å †æ ˆä¿¡æ¯å¯¹äºè¯Šæ–­éå¸¸é‡è¦ã€‚

å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†è¯Šæ–­ä¿¡æ¯æ‰“å°åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œä»¥å¤‡åç»­ä½¿ç”¨ç›¸å…³å·¥å…·ï¼ˆå¦‚ï¼š`VisualVM`ã€`HPJmeter`ã€`IBM Heap Analyzer`ã€[MAT](https://help.eclipse.org/latest/index.jsp?topic=/org.eclipse.mat.ui.help/welcome.html)ï¼‰åˆ†æ ` ä¿¡æ¯ã€‚

```bash
$ jcmd 6 GC.heap_dump xxx.dump
```

ä»¥ä¸Šå‘½ä»¤å°†ç”Ÿæˆæ ¼å¼ä¸º `hprof` çš„ heap dump ä¿¡æ¯ï¼Œå¹¶è¾“å‡ºåˆ°å½“å‰ç›®å½•çš„æŒ‡å®šæ–‡ä»¶ä¸­ã€‚

ä»¥ä¸Šå‘½ä»¤å’Œ `jmap -dump:file=<file> <pid>` ç­‰æ•ˆã€‚**å»ºè®®ä½¿ç”¨ jcmd** ã€‚

### æ‰“å°å †çš„åŸºæœ¬ä¿¡æ¯

```bash
$ jcmd 6 GC.heap_info
6:
 PSYoungGen      total 28672K, used 14018K [0x00000000d7400000, 0x00000000d9180000, 0x0000000100000000)
  eden space 27136K, 49% used [0x00000000d7400000,0x00000000d8118998,0x00000000d8e80000)
  from space 1536K, 39% used [0x00000000d9000000,0x00000000d9098000,0x00000000d9180000)
  to   space 1536K, 0% used [0x00000000d8e80000,0x00000000d8e80000,0x00000000d9000000)
 ParOldGen       total 139776K, used 72833K [0x0000000085c00000, 0x000000008e480000, 0x00000000d7400000)
  object space 139776K, 52% used [0x0000000085c00000,0x000000008a320418,0x000000008e480000)
 Metaspace       used 104175K, capacity 118500K, committed 120984K, reserved 1155072K
  class space    used 11482K, capacity 14484K, committed 15024K, reserved 1048576K
```

### æ‰“å° Class ç›´æ–¹å›¾

æ‰“å°å‡º Class  Histogramï¼š

```bash
$ jcmd 6 GC.class_histogram > xxx.txt
```

æ‰“å°å‡ºçš„ä¿¡æ¯å¯èƒ½ç›¸å½“å†—é•¿ï¼Œæ‰€ä»¥ä¸€èˆ¬å°†å‘½ä»¤çš„è¾“å‡ºä¿¡æ¯é‡å®šå‘åˆ°æ–‡ä»¶ä¸­ã€‚

åˆ—è¡¨ä¿¡æ¯ä¸­ï¼ŒåŒ…æ‹¬äº†å†…éƒ¨ç±»å’Œç‰¹å®šäºåº”ç”¨ç¨‹åºçš„ç±»ã€‚**å ç”¨å†…å­˜æœ€å¤šçš„ç±»åˆ—åœ¨é¡¶éƒ¨ï¼Œç±»æŒ‰é™åºæ’åˆ—**ã€‚

æ›´å¤šå‘½ä»¤ç»†èŠ‚è¯·å‚è€ƒå‘½ä»¤å¸®åŠ©ï¼š

```bash
$ jcmd 6 help GC.class_histogram
6:
GC.class_histogram
Provide statistics about the Java heap usage.

Impact: High: Depends on Java heap size and content.

Permission: java.lang.management.ManagementPermission(monitor)

Syntax : GC.class_histogram [options]

Options: (options must be specified using the <key> or <key>=<value> syntax)
	-all : [optional] Inspect all objects, including unreachable objects (BOOLEAN, false)
```

### æ˜¾ç¤ºç±»ç»Ÿè®¡ä¿¡æ¯

è¯¥å‘½ä»¤éœ€è¦ `JVM` æŒ‡å®šäº† `-XX:+UnlockDiagnosticVMOptions` flagï¼Œå¦åˆ™è¿è¡Œå‘½ä»¤ä¼šæç¤ºï¼š

```bash
$ jcmd 6 GC.class_stats
6:
GC.class_stats command requires -XX:+UnlockDiagnosticVMOptions
```

æ›´å¤šå…³äºå‘½ä»¤çš„ä½¿ç”¨ç»†èŠ‚ï¼Œè¯·å‚è€ƒå‘½ä»¤å¸®åŠ©ï¼š

```bash
$ jcmd 6 help GC.class_stats
6:
GC.class_stats
Provide statistics about Java class meta data. Requires -XX:+UnlockDiagnosticVMOptions.

Impact: High: Depends on Java heap size and content.

Syntax : GC.class_stats [options] [<columns>]

Arguments:
	columns : [optional] Comma-separated list of all the columns to show. If not specified, the following columns are shown: InstBytes,KlassBytes,CpAll,annotations,MethodCount,Bytecodes,MethodAll,ROAll,RWAll,Total (STRING, no default value)

Options: (options must be specified using the <key> or <key>=<value> syntax)
	-all : [optional] Show all columns (BOOLEAN, false)
	-csv : [optional] Print in CSV (comma-separated values) format for spreadsheets (BOOLEAN, false)
	-help : [optional] Show meaning of all the columns (BOOLEAN, false)
```

### æ˜¾ç¤º System Properties

æ‰“å°å‡ºæŒ‡å®š JVM è¿›ç¨‹è®¾ç½®çš„æ‰€æœ‰ System Propertiesï¼š

```bash
$ jcmd 6 VM.system_properties
6:
#Sat Sep 04 16:54:55 GMT 2021
jna.platform.library.path=/usr/lib\:/lib
java.runtime.name=OpenJDK Runtime Environment
sun.boot.library.path=/usr/lib/jvm/java-1.8-openjdk/jre/lib/amd64
java.vm.version=25.212-b04
mail.smtp.sendpartial=true
java.vm.vendor=IcedTea
java.vendor.url=https\://icedtea.classpath.org
path.separator=\:
java.vm.name=OpenJDK 64-Bit Server VM
...
```

### æ˜¾ç¤ºå‘½ä»¤è¡Œå‚æ•°

```bash
$ jcmd 6 VM.command_line
6:
VM Arguments:
jvm_args: -Duser.home=/var/jenkins_home -Djenkins.model.Jenkins.slaveAgentPort=50000
java_command: /usr/share/jenkins/jenkins.war
java_class_path (initial): /usr/share/jenkins/jenkins.war
Launcher Type: SUN_STANDARD
```

è¿™äº›è®¾å®šçš„å‚æ•°ï¼Œæœ€ç»ˆä¼šä½“ç°åœ¨ JVM çš„ System Properties ä¸­ã€‚

### æ˜¾ç¤º VM flags

```bash
$ jcmd 6 VM.flags
6:
-XX:CICompilerCount=2 -XX:InitialHeapSize=130023424 -XX:MaxHeapSize=2051014656 -XX:MaxNewSize=683671552 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=42991616 -XX:OldSize=87031808 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC
```

### æ˜¾ç¤ºè™šæ‹Ÿæœºç‰ˆæœ¬

```bash
$ jcmd VM.version
6:
OpenJDK 64-Bit Server VM version 25.212-b04
JDK 8.0_212
```

### æ˜¾ç¤ºè¿è¡Œæ—¶é•¿

æ‰“å°å‡ºæŒ‡å®š JVM è¿›ç¨‹æ­£å¸¸è¿è¡Œçš„æ—¶é•¿ã€‚å•ä½ï¼šç§’ã€‚

```bash
$ jcmd 6 VM.uptime 
6:
15513470.085 s
```

### æ˜¾ç¤º finalization é˜Ÿåˆ—ä¿¡æ¯

```bash
$ jcmd 6 GC.finalizer_info
6:
No instances waiting for finalization found
```

### è°ƒç”¨ java.lang.System.runFinalization

```bash
$ jcmd 6 GC.run_finalization
6:
Command executed successfully
```

### è°ƒç”¨ java.lang.System.gc()

```bash
$ jcmd 6 GC.run
6:
Command executed successfully
```

### æ‰“å°æ‰€æœ‰çš„ ClassLoader ç»Ÿè®¡ä¿¡æ¯

```bash
$ jcmd 6 VM.classloader_stats
...
0x0000000100282d60  0x0000000100285548  0x000055e891973a40      11    110592     63328  hudson.ClassicPluginStrategy$AntClassLoader2
0x0000000100285548  0x0000000100285230  0x0000000000000000       0         0         0  hudson.ClassicPluginStrategy$DependencyClassLoader
0x00000001001babc0  0x000000010000f298  0x000055e8924852a0       0         0         0  com.thoughtworks.xstream.core.util.CompositeClassLoader
0x000000010000f630  0x0000000000000000  0x000055e8924d3440      91    675840    618848  sun.misc.Launcher$ExtClassLoader
0x000000010000e900  0x000000010000e900  0x000055e891de9e20       0         0         0  java.net.URLClassLoader
0x000000010000f298  0x000000010000f630  0x000055e8918a35a0       4     73728     35464  sun.misc.Launcher$AppClassLoader
Total = 1321                                                 18166  121317376  106377664
ChunkSz: Total size of all allocated metaspace chunks
BlockSz: Total size of all allocated metaspace blocks (each chunk has several blocks)
```

### å¼ºåˆ¶ GC æ—¥å¿—æ–‡ä»¶è½®è½¬ï¼ˆrotateï¼‰

```bash
$ jcmd 6 GC.rotate_log
```

å‰æï¼šå¯åŠ¨ JVM æ—¶éœ€è¦å¯ç”¨ GC æ—¥å¿—è®°å½•ï¼Œä»¥åŠè®¾ç½®æ—¥å¿—è½®è½¬ç›¸å…³ flagsï¼š

```
-XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:gc-%t.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=20M
```

å¦åˆ™ï¼Œä¼šæç¤ºé”™è¯¯ï¼š

```bash
$ jcmd 6 GC.rotate_log
6:
Target VM does not support GC log file rotation.
```

### æŸ¥çœ‹åŸç”Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ

åœ¨å¯ç”¨äº† [-XX:NativeMemoryTracking](https://docs.oracle.com/javase/8/docs/technotes/guides/vm/nmt-8.html) çš„ JVM ä¸­ï¼ŒæŸ¥çœ‹åŸç”Ÿå†…å­˜ä½¿ç”¨æƒ…å†µï¼š

```bash
$ jcmd 6 VM.native_memory
```



![image-20210907144702010](https://raw.githubusercontent.com/gukt/images/master/github/images20210907144711.png)





### TODO

ManagementAgent.stop
ManagementAgent.start_local
ManagementAgent.start

- [x] å†™ä¸€ä¸ª hello.jarï¼Œæ‰“åŒ…ä¸€ä¸ªå¯æ‰§è¡Œ jar
- [x] å°† hello.jar è¿è¡Œåœ¨æœ¬åœ°
- [x] ä½¿ç”¨ jcmd æŸ¥çœ‹ helloã€‚jar çš„ç›¸å…³ä¿¡æ¯
- [x] ä½¿ç”¨ jconsole è¿æ¥æœ¬åœ° hello jvm
- [x] ä½¿ç”¨ visualvm
- [x] è§£å†³ jmc åœ¨ Mac OS ä¸Šæ‰“ä¸å¼€çš„é—®é¢˜
- [x] ä½¿ç”¨ JFR
- [x] ä½¿ç”¨ jmc è¿æ¥
- [ ] å°† hello.jar æ‹·è´åˆ° codedog996, æŸ¥çœ‹è¿œç¨‹è¿æ¥ jvm
- [ ] å¼€å¯ 9999 ç«¯å£ï¼Œ@biz1 ä¸»æœº
- [ ] å¦‚æœ biz1 æ²¡æœ‰å®‰è£… javaï¼Œå®‰è£…ä¸€ä¸‹æœ€æ–°çš„ jdk1.8.0
- [ ] åªå¼€ 9999 ç«¯å£ä¸ºä»€ä¹ˆè¿æ¥ä¸ä¸Šï¼Ÿ
- [ ] 

### å‚è€ƒ

1. https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr006.html
2. [jcmd command man page](https://docs.oracle.com/javase/8/docs/technotes/tools/windows/jcmd.html)
3. https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr007.html
4. https://docs.oracle.com/javase/8/docs/technotes/guides/vm/nmt-8.html
5. https://docs.oracle.com/javase/7/docs/technotes/tools/share/jstack.html
6. https://dzone.com/articles/try-to-avoid-xxusegclogfilerotation
7. https://www.cnblogs.com/dengq/p/13687510.html
8. https://medium.com/@chrishantha/basic-concepts-of-java-heap-dump-analysis-with-mat-e3615fd79eb



## TODO jmap å‘½ä»¤

è¯¥å‘½ä»¤ç”¨äºæ‰“å°è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚

è¯­æ³•ï¼š``jmap` [*options*] *pid*`ã€‚



## TODO jstat & jstatd å‘½ä»¤è¯¦è§£

### jstatd 

> The `jstatd` command is an RMI server application that monitors for the creation and termination of instrumented Java HotSpot VMs and provides an interface to enable remote monitoring tools to attach to JVMs that are running on the local host.The `jstatd` server requires an RMI registry on the local host. The `jstatd` server attempts to attach to the RMI registry on the default port, or on the port you specify with the `-p` `port` option. If an RMI registry is not found, then one is created within the `jstatd` application that is bound to the port that is indicated by the `-p` `port` option or to the default RMI registry port when the `-p` `port` option is omitted. You can stop the creation of an internal RMI registry by specifying the `-nr` option.

æ˜¯ä¸€ä¸ª JMI æœåŠ¡å™¨åº”ç”¨ã€‚å®ƒæä¾›ä¸€ä¸ªæ¥å£ï¼Œä»¥ä½¿è¿œç¨‹ç›‘è§†å·¥å…·å¯ä»¥é€šè¿‡è¿æ¥åˆ°æœ¬æœºè¿è¡Œçš„ JVMã€‚

éœ€è¦æœ¬åœ°ä¸»æœºä¸Šçš„ RMI Registryï¼Œ

å®ƒè¯•å›¾ä½¿ç”¨é»˜è®¤ç«¯å£é™„åŠ åˆ° RMI Registryã€‚å¯ä»¥ä½¿ç”¨ -p é€‰å‹è®¾å®š RMI Registry ç«¯å£ã€‚å¦‚æœ RMI Registry æ²¡æœ‰æ‰¾åˆ°ï¼Œjstatd è¿›ç¨‹å†…éƒ¨ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª RMI Registry å¹¶è¢«ç»‘å®šåˆ°æŒ‡å®šçš„ç«¯å£ï¼ˆ-p æŒ‡å®šçš„æˆ–é»˜è®¤ç«¯å£ï¼‰ï¼Œé€šè¿‡ -nr é€‰å‹å¯ä»¥ç¦æ­¢jstatd åœ¨è¿›ç¨‹å†…éƒ¨åˆ›å»º RMI Registryã€‚

Caused by: java.lang.ClassNotFoundException: sun.jvmstat.monitor.remote.RemoteHost

å‘ç”Ÿè¿™ä¸ªå¼‚å¸¸çš„åŸå› æ˜¯ï¼šç«¯å£è¢«å ç”¨äº†ã€‚

æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µï¼š

```bash
$ 
```







JVM ç»Ÿè®¡ç›‘è§†å·¥å…·ã€‚

### å‘½ä»¤å¸®åŠ©

```bash
$ jstat -help
Usage: jstat -help|-options
       jstat -<option> [-t] [-h<lines>] <vmid> [<interval> [<count>]]

Definitions:
  <option>      An option reported by the -options option
  <vmid>        Virtual Machine Identifier. A vmid takes the following form:
                     <lvmid>[@<hostname>[:<port>]]
                Where <lvmid> is the local vm identifier for the target
                Java virtual machine, typically a process id; <hostname> is
                the name of the host running the target Java virtual machine;
                and <port> is the port number for the rmiregistry on the
                target host. See the jvmstat documentation for a more complete
                description of the Virtual Machine Identifier.
  <lines>       Number of samples between header lines.
  <interval>    Sampling interval. The following forms are allowed:
                    <n>["ms"|"s"]
                Where <n> is an integer and the suffix specifies the units as
                milliseconds("ms") or seconds("s"). The default units are "ms".
  <count>       Number of samples to take before terminating.
  -J<flag>      Pass <flag> directly to the runtime system.
```

å‚æ•°è¯´æ˜ï¼š

* options - é€‰å‹ï¼Œå¯ä»¥ä½¿ç”¨ `jstat -options` æŸ¥çœ‹æ”¯æŒçš„æ‰€æœ‰é€‰é¡¹ã€‚
* <vimd>

### ç»Ÿè®¡é€‰é¡¹åŠå­—æ®µè¯´æ˜

è¯·è§ [å®˜æ–¹æ–‡æ¡£](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html)ã€‚

https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstatd.html#BABHHDIB

https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html

https://www.cnblogs.com/pyvm/articles/11939854.html

https://docs.oracle.com/javase/7/docs/technotes/tools/solaris/rmiregistry.html

https://www.cnblogs.com/easonjim/p/7483739.html

https://www.onekbit.com/ViewBlog/blog/BID20191226100249

https://www.jianshu.com/p/97f09e1648a6

https://blog.csdn.net/renfufei/article/details/53187123

https://blog.csdn.net/q13554515812/article/details/89712423

https://docs.oracle.com/javase/1.5.0/docs/guide/management/agent.html#properties

### jstatd

è¯¥å·¥å…·ç”¨æ¥ç›‘è§† JVMï¼Œå¹¶ä½¿è¿œç¨‹ç›‘æ§å·¥å…·èƒ½å¤Ÿé™„åŠ åˆ° JVMã€‚

> Monitors Java Virtual Machines (JVMs) and enables remote monitoring tools to attach to JVMs. This command is experimental and unsupported.

å‚è€ƒï¼š

1. https://my.oschina.net/usenrong/blog/197816

TODO

- [ ] è¿æ¥è¿œç¨‹ JVM
- [ ] 



å‚è€ƒï¼š

1. https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html
2. https://www.jianshu.com/p/845924a1b8f2



## RMI

Java RMIç”¨äºä¸åŒè™šæ‹Ÿæœºä¹‹é—´çš„é€šä¿¡ï¼Œè¿™äº›è™šæ‹Ÿæœºå¯ä»¥åœ¨ä¸åŒçš„ä¸»æœºä¸Šã€ä¹Ÿå¯ä»¥åœ¨åŒä¸€ä¸ªä¸»æœºä¸Šï¼›

å‚è€ƒï¼š

1. https://docs.oracle.com/javase/7/docs/technotes/tools/solaris/rmiregistry.html



## TODO ä½¿ç”¨ JMX ç›‘æ§å’Œç®¡ç†è¿œç¨‹ JVM

ä¸ºäº†å¯ç”¨ JMX ä»£ç†ä»¥ç›‘æ§å’Œç®¡ç† JVMï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¯åŠ¨ JVM æ—¶ï¼Œè®¾å®šä¸€äº›ç³»ç»Ÿå±æ€§ã€‚

æ—©æœŸç‰ˆæœ¬éœ€è¦æŒ‡å®š `com.sun.management.jmxremote`ï¼Œä¸è¿‡ç°åœ¨å·²ç»ä¸éœ€è¦äº†ã€‚

å¦‚æœæƒ³è¦å¯ç”¨ç›‘æ§å’Œç®¡ç†è¿œç¨‹æœåŠ¡å™¨ï¼Œå¯åŠ¨ JVM æ—¶æ·»åŠ å¦‚ä¸‹ç³»ç»Ÿå±æ€§ï¼ˆSystem Propertyï¼‰

```properties
com.sun.management.jmxremote.port=9999
```

é»˜è®¤æ˜¯å¯ç”¨å¯†ç éªŒè¯çš„ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å±æ€§è®¾ç½®ä»¥ç¦ç”¨å¯†ç éªŒè¯ï¼š

```properties
com.sun.management.jmxremote.authenticate=false
```

å½“ç¦ç”¨å¯†ç æ—¶ï¼Œä¹Ÿå¯ä»¥åŒæ—¶ç¦ç”¨ SSLï¼š

```properties
com.sun.management.jmxremote.ssl=false
```

æ³¨æ„ï¼šå¦‚æœç¦ç”¨äº†å¯†ç å’Œ SSL éªŒè¯ï¼Œä»»ä½•äººåªè¦çŸ¥é“ä½ çš„è¿œç¨‹ä¸»æœºåå’Œç«¯å£å·ï¼Œéƒ½å¯ä»¥ç›‘æ§å’Œæ§åˆ¶ JVMï¼Œæ‰€ä»¥ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç¦ç”¨è¿™äº›éªŒè¯ã€‚



ç½‘ä¸Šå¾ˆå¤šæ–‡ç« è®¾ç½®äº†ä»¥ä¸‹ç³»ç»Ÿå±æ€§ï¼š

```properties
com.sun.management.jmxremote=true
com.sun.management.jmxremote.local.only=false
java.net.preferIPv4Stack=true
```



```sh
java \
-Djava.rmi.server.hostname=codedog996.com \
-Dcom.sun.management.jmxremote.port=9999 \
-Dcom.sun.management.jmxremote.authenticate=false \
-Dcom.sun.management.jmxremote.ssl=false \
-jar hello.jar
```

```bash
java \
-Dcom.sun.management.jmxremote.port=9999 \
-Dcom.sun.management.jmxremote.authenticate=false \
-Dcom.sun.management.jmxremote.ssl=false \
-jar hello.jar
```



é”™è¯¯: æ‰¾ä¸åˆ°å£ä»¤æ–‡ä»¶: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.302.b08-0.el7_9.x86_64/jre/lib/management/jmxremote.password



å‚è€ƒï¼š

1. [Official Documentationï¼šMonitoring and Management Using JMX](https://docs.oracle.com/javase/1.5.0/docs/guide/management/agent.html#sysprops)



# 9ã€ğŸŒˆ MISC

## æ‰§è¡Œ test æ—¶ï¼Œè°ƒç”¨ getClass().getResource() æ—¶ï¼Œä¼šåœ¨é‚£äº›è·¯å¾„ä¸‹æŸ¥æ‰¾ï¼Ÿ

ç¼–è¯‘çš„æ–‡ä»¶ä¸€èˆ¬åœ¨ out ç›®å½•ä¸‹ï¼Œè¯¥ç›®å½•ä¸‹å­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼š

test å’Œ productionï¼Œå…¶ä¸­ resources ç›®å½•åœ¨ out/production ä¸‹ï¼Œå¦‚æœä½ è¦æŸ¥æ‰¾ä¸€ä¸ªæ–‡ä»¶æ¯”å¦‚ï¼š

getClass().getResource("/config") ï¼Œå¦‚æœé¡¹ç›®çš„ resources/config ç›®å½•å­˜åœ¨ï¼ˆ**æ³¨æ„ï¼šä¸”è¦æœ‰æ–‡ä»¶ï¼Œä¸ç„¶ç¼–è¯‘æ—¶ä¸ä¼šå°†ç©ºç›®å½•ç¼–è¯‘åˆ° out/production/ ä¸‹**ï¼‰ï¼Œåˆ™å°±å¯ä»¥æ­£å¸¸è¿”å›ã€‚



## ä¸ºä»€ä¹ˆGuava ä¸­çš„å¾ˆå¤š API æ ‡æœ‰ @Beta æ³¨è§£ IDEA ä¼šæç¤ºè­¦å‘Š

Guava ä¸­çš„å¾ˆå¤š API éƒ½æ ‡æœ‰ @Beta æ³¨è§£ï¼Œæ¯”å¦‚ï¼šHashing, EventBus ç­‰ã€‚

IDEA ä¼šç»™ä½¿ç”¨äº†è¿™äº› API çš„åœ°æ–¹æç¤ºï¼š

'com.google.common.hash.Hashing' is marked unstable with @Beta 

è¯·çœ‹è¿™ç¯‡æ–‡ç« çš„è®¨è®ºï¼š[Is it safe to use Hashing class from com.google.common.hash?](https://stackoverflow.com/questions/53060907/is-it-safe-to-use-hashing-class-from-com-google-common-hash)

æ€»ä¹‹ï¼Œæ²¡æœ‰ä»€ä¹ˆï¼ŒGuava å·²ç»ç”¨çš„å¾ˆå¹¿æ³›äº†ã€‚

åœ¨ IDEA é‡ŒæŠŠè¿™ä¸ªè­¦å‘Šç»™å»æ‰å°±å¥½äº†ã€‚

æŒ‰ä¸‹ "Command + 1"ï¼Œåœ¨æç¤ºçš„â€œInspection on â€œUnstable API Usageâ€ Optionsâ€ ä¸Šç‚¹å‡»ï¼Œç„¶åé€‰æ‹© â€œDisable Inspectionâ€ å³å¯ã€‚æˆ–è€…é€‰æ‹© "Edit inspection profile setting"ï¼Œç„¶ååœ¨å¼¹å‡ºæ¡†ä¸­ä¼šè‡ªåŠ¨å®šä½åˆ°ç›¸åº”é€‰å‹ï¼Œå–æ¶ˆå‹¾é€‰å³å¯ã€‚



## è§£å†³ git æ— æ³•è¿æ¥ä»“åº“çš„é—®é¢˜

å‡ºç°çš„é”™è¯¯ï¼š**æ— æ³•è¿æ¥ä»“åº“ï¼šCommand "git ls-remote -h -- http://git.laogu.io:10001/root/url-rescuer.git HEAD" returned status code 128**

è¿™æ˜¯å› ä¸ºåœ¨ jenkins ä¸Šæ²¡æœ‰æ‰¾åˆ° git çš„åŸå› ï¼Œéœ€è¦åœ¨ â€œå…¨å±€å·¥å…·é…ç½®â€ é‡Œé…ç½®ä¸€ä¸‹ã€‚

```sh
#è¿›å…¥jenkinså®¹å™¨
docker exec -it jenkins sh

#æ‰¾åˆ°gitçš„ç‰ˆæœ¬åŠè·¯å¾„
type git
git is /usr/bin/git

#æ‰“å°gitç‰ˆæœ¬å·
git --version
git version 2.20.2

#è¿›å…¥jenkinsçš„å…¨å±€å·¥å…·é…ç½®ï¼Œæ‰¾åˆ°gité‚£ä¸ªç»„
åœ¨Nameä¸­å¡«å…¥ï¼šgit-2.20.2
åœ¨Path to Git executableä¸­å¡«å…¥ï¼š/usr/bin/git

#è¿›å…¥jobçš„é…ç½®é¡µï¼Œæ£€æŸ¥é”™è¯¯æ˜¯å¦æ¶ˆå¤±
#å¦‚æœå‘ç°è¿˜æ˜¯æŠ¥é”™ï¼Œå°†ä¹‹å‰å¡«å†™çš„ç”¨æˆ·ååˆ æ‰é‡æ–°è®¾ç½®è¯•è¯•
```



## å¦‚ä½•è¿ç§» Jenkins çš„ jobsï¼Ÿ

å…¶å®å¾ˆç®€å•ï¼Œå°† jobs ç›®å½•ä¿å­˜å¥½ï¼Œå†æ¢å¤å°±å¥½äº†ã€‚



## åŠ é€Ÿ Jenkins æ’ä»¶ä¸‹è½½

è¿›å…¥ï¼šç³»ç»Ÿç®¡ç† -> æ’ä»¶ç®¡ç† -> é«˜çº§ -> å‡çº§ç«™ç‚¹ã€‚

åœ¨ URL ä¸­å¡«å…¥ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.jsonï¼Œå¹¶æäº¤ã€‚

å…¶å®è¿™é‡Œå¡«çš„å†…å®¹å°±å†™åœ¨`/data/jenkins/hudson.model.UpdateCenter.xml`æ–‡ä»¶ä¸­ã€‚

ï¼ˆå®Œï¼‰

## Tomcat 8å…è®¸è®¿é—®è½¯è¿æ¥ç›®å½•ä¸‹çš„æ–‡ä»¶

ä¿®æ”¹ conf/context.xmlï¼š

```
<!-- Tomcat 7: --><Context allowLinking="true" /><!-- Tomcat 8: --><Context>  <Resources allowLinking="true" /></Context>
```

ä¿®æ”¹åé‡å¯tomcat!

## Springboot ä»¥ jar åŒ…æ–¹å¼è¿è¡Œæ—¶æŒ‡å®šå‚æ•°

```bash
#æŒ‡å®šmainå‡½æ•°å‚æ•°
$ java -jar foo.jar p1 p2
#ä¸Šè¿°å‚æ•°p1,p2é€šè¿‡mainå‡½æ•°è·å–

#è¦†ç›– application.propertiesä¸­æŒ‡å®šçš„å‚æ•°å€¼
$ java -jar foo.jar --p1=v1 --p2=v2

#æŒ‡å®šSystem.properties
$ java -jar foo.jar -Dp1=v1 -Dp2=v2
#ä¸Šè¿°æŒ‡å®šçš„å‚æ•°å¯é€šè¿‡System.getProperty("p1")è·å–
```

## æ›¿æ¢/è¿˜åŸ brew.git å’Œ homebrew-core.git ä»“åº“åœ°å€

```bash
# æ›¿æ¢æˆé˜¿é‡Œå·´å·´çš„ brew.git ä»“åº“åœ°å€:
$ cd "$(brew --repo)"
$ git remote set-url origin <https://mirrors.ustc.edu.cn/brew.git>

# æ›¿æ¢æˆé˜¿é‡Œå·´å·´çš„ homebrew-core.git ä»“åº“åœ°å€:
$ cd "$(brew --repo)/Library/Taps/homebrew/homebrew-core"
$ git remote set-url origin <https://mirrors.ustc.edu.cn/homebrew-core.git>

#=======================================================

# è¿˜åŸä¸ºå®˜æ–¹æä¾›çš„ brew.git ä»“åº“åœ°å€
$ cd "$(brew --repo)"
$ git remote set-url origin <https://github.com/Homebrew/brew.git>

# è¿˜åŸä¸ºå®˜æ–¹æä¾›çš„ homebrew-core.git ä»“åº“åœ°å€
$ cd "$(brew --repo)/Library/Taps/homebrew/homebrew-core"
$ git remote set-url origin <https://github.com/Homebrew/homebrew-core.git>
```

## è®¾ç½®è®¿é—®é™æ€èµ„æº

```
#æ‰“å¼€é»˜è®¤é…ç½®æ–‡ä»¶
vim /etc/nginx/conf.d/default.conf

#è¾“å…¥ä¸€ä¸‹å†…å®¹
server {
    listen 80;
    server_name img.xxx.com;
    root /static/;
}
#è¾“å…¥wqä¿å­˜é€€å‡º

#é‡å¯nginx
systemctl restart nginx
```

## è®¾ç½®ç«¯å£è½¬å‘åŠè®¿é—®ç™½åå•

```
#æ‰“å¼€/etc/nginx/nginx.conf
vim /etc/nginx/nginx.conf

#åœ¨httpé‡Œæ·»åŠ server{...}æ®µï¼š
http {
	...

    server {
        listen       42100;
        server_name  127.0.0.1:8100;
        location / {
            proxy_pass   <http://127.0.0.1:8100>;
        }
				allow 117.136.117.144;
        deny  all;
    }
}
```

## ä¸€ä¸ªå…¸å‹çš„ã€ç®€å•çš„ logback.xml é…ç½®

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true" scanPeriod="180 seconds">
    <!-- æ—¥å¿—æ–‡ä»¶å-->
    <property name="LOG_FILE_NAME" value="shuliao"/>
    <!-- æ—¥å¿—æ–‡ä»¶æ‰©å±•å-->
    <property name="LOG_FILE_EXT_NAME" value="log"/>
    <!-- æ—¥å¿—å­˜æ”¾æ ¹ç›®å½•-->
    <property name="LOG_HOME" value="${app.log-home:-/data/shuliao/log}"/>

    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %class{0}[%line] - %msg%n</pattern>
        </encoder>
    </appender>
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_HOME}/${LOG_FILE_NAME}.${LOG_FILE_EXT_NAME}</file>
        <encoder charset="UTF-8" class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <Pattern>%d [%thread] %-5level %class{0}[%line] - %msg%n</Pattern>
        </encoder>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${LOG_HOME}/${LOG_FILE_NAME}.%d{yyyy-MM-dd}.%i.${LOG_FILE_EXT_NAME}.zip</fileNamePattern>
            <!-- æ¯ä¸ªæ–‡ä»¶è‡³å°‘ 100MBï¼›æœ€å¤šä¿å­˜ 30ï¼›æœ€å¤š 20GB -->
            <maxFileSize>100MB</maxFileSize>
            <maxHistory>60</maxHistory>
            <totalSizeCap>20GB</totalSizeCap>
        </rollingPolicy>
    </appender>

    <root level="DEBUG">
        <appender-ref ref="STDOUT"/>
        <appender-ref ref="FILE"/>
    </root>
</configuration>
```

## å¦‚ä½•è®¾ç½®æ—¥å¿—å­˜æ”¾æ ¹ç›®å½•ï¼Ÿ

åœ¨ `logback.xml` æ–‡ä»¶ä¸­ï¼š

```xml
<configuration scan="true" scanPeriod="180 seconds">
  <!-- å®šä¹‰ä¸€ä¸ª LOG_HOME å±æ€§ï¼Œè¯¥å€¼ä» app.log-home ç³»ç»Ÿå±æ€§ä¸­è¯»å–ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥ç³»ç»Ÿå±æ€§ï¼Œåˆ™ä½¿ç”¨æŒ‡å®šçš„é»˜è®¤å€¼ï¼ˆ':-'åé¢çš„å­—ç¬¦ä¸²ï¼‰ -->
	<property name="LOG_HOME" value="${app.log-home:-/data/xxx/log}"/>
 	<appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_HOME}/shuliao.log</file>
    		...
  </appender>
  ...
</configuration>
```

åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬åªè¦åœ¨å¯åŠ¨å‘½ä»¤ä¸­è®¾å®šç³»ç»Ÿå±æ€§ `app.log-home` å³å¯ï¼š

```java
$ java -jar -Dapp.log-home=/data/app-name/log app.jar
```

å¦‚æœåœ¨ IDEA ä¸­è°ƒè¯•ï¼Œè¯·åœ¨ `Run/Debug Configurations` å¯¹è¯æ¡†ä¸­çš„ `VM Options` ä¸­æŒ‡å®šï¼š

```java
-Dapp.log-home=/data/app-name/log
```

### é—®é¢˜ï¼šSizeAndTimeBasedFNATP is deprecated. Use SizeAndTimeBasedRollingPolicy instead

For more information see http://logback.qos.ch/manual/appenders.html#SizeAndTimeBasedRollingPolicyã€‚

## å¯åŠ¨ Jenkins@mac

```bash
#æŸ¥çœ‹æœ¬æœºå®‰è£…çš„jenkinsç›¸å…³ä¿¡æ¯
brew info jenk
#å¯åŠ¨jenkinsæœåŠ¡
brew services start jenkins
#å¯åŠ¨å®Œæˆåï¼ŒæŸ¥çœ‹è¿›ç¨‹
ps aux|grep jenkins
ktgu             98760  10.5 11.1  8055320 934564   ??  S    12:55ä¸Šåˆ   0:52.98 /usr/bin/java -Dmail.smtp.starttls.enable=true -jar /usr/local/opt/jenkins/libexec/jenkins.war --httpListenAddress=127.0.0.1 --httpPort=8080
#é‡å¯jenkins
brew services restart jenkins
#æ˜¾ç¤ºæ‰€æœ‰æœåŠ¡
brew services list
```

### Postmanä¸­ body æ•°æ®çš„ 4 ç§å¡«å……æ–¹å¼

bodyæ•°æ®æœ‰4ç§å¡«å……æ–¹å¼ï¼šform-dataã€x-www-form-urlencodedã€rawã€binary

1. form-data: è¡¨ç¤ºhttpè¯·æ±‚ä¸­çš„multipart/form-data

2. x-www-form-urlencoded: ä¼šæŠŠè¡¨å•æ•°æ®è½¬æ¢ä¸ºé”®å€¼å¯¹

   form-dataä¸x-www-form-urlencodedçš„åŒºåˆ«

   - multipart/form-dataï¼š**å¯ä»¥ä¸Šä¼ æ–‡**ä»¶**æˆ–è€…é”®å€¼å¯¹**ï¼Œæœ€åéƒ½ä¼šè½¬åŒ–ä¸ºä¸€æ¡æ¶ˆæ¯
   - x-www-form-urlencodedï¼š**åªèƒ½ä¸Šä¼ é”®å€¼å¯¹**ï¼Œè€Œä¸”é”®å€¼å¯¹éƒ½æ˜¯é€šè¿‡&é—´éš”åˆ†å¼€çš„

3. raw: å¯ä»¥ä¸Šä¼ ä»»æ„æ ¼å¼çš„æ–‡æœ¬ï¼Œæ–‡æœ¬ä¸åšä»»ä½•ä¿®é¥°ä¼ åˆ°æœåŠ¡ç«¯ã€‚æ¯”å¦‚ä¼ ä¸€äº›xmlï¼Œæˆ–è€…jsonæ•°æ®ï¼Œæˆ–è€…textæ–‡æœ¬æ•°æ®

4. binary: ç›¸å½“äºContent-Type:application/octet-stream,åªå¯ä»¥ä¸Šä¼ äºŒè¿›åˆ¶æ•°æ®ï¼Œé€šå¸¸ç”¨æ¥ä¸Šä¼ æ–‡ä»¶ï¼Œä½†æ˜¯ä¸€æ¬¡åªèƒ½ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶

## è¿‡é«˜å¹¶å‘ä½¿ç”¨ wrk è€Œé ab

æ³¨æ„æµ‹è¯•çš„æ—¶å€™ç”¨ wrk ä¸è¦ç”¨å…¶ä»–çš„å·¥å…·ï¼Œæ¯”å¦‚ abï¼Œå½“å¹¶å‘è¿‡é«˜çš„æ—¶å€™ ab è‡ªå·±å°±æ˜¯ç“¶é¢ˆï¼Œè€Œ wrk è½»æ¾è¿‡åä¸‡ã€‚





